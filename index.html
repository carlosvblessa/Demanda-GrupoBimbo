<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Carlos Virgílio Beltrão Lessa" />


<title>Demanda de estoque do Grupo Bimbo</title>

<script src="Projeto02_files/jquery-3.5.1/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="Projeto02_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="Projeto02_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="Projeto02_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="Projeto02_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="Projeto02_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="Projeto02_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="Projeto02_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="Projeto02_files/navigation-1.1/tabsets.js"></script>
<link href="Projeto02_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="Projeto02_files/highlightjs-9.12.0/highlight.js"></script>
<script src="Projeto02_files/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="Projeto02_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="Projeto02_files/datatables-binding-0.17/datatables.js"></script>
<link href="Projeto02_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="Projeto02_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="Projeto02_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="Projeto02_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="Projeto02_files/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script src="Projeto02_files/kePrint-0.0.1/kePrint.js"></script>
<link href="Projeto02_files/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Demanda de estoque do Grupo Bimbo</h1>
<h4 class="author">Carlos Virgílio Beltrão Lessa</h4>
<h4 class="date">30 de janeiro de 2021</h4>

</div>


<div id="objetivo" class="section level1">
<h1><span class="header-section-number">1</span> Objetivo</h1>
<p>Prever a demanda de um produto para uma determinada semana, em uma loja específica.</p>
<p><a href="https://www.grupobimbo.com/">Grupo Bimbo</a>, líder global na indústria de panificação e um importante player em lanches, patrocinou uma competição premiada no Kaggle para reduzir suas perdas com devoluções e ao mesmo manter supridas com seus produtos as prateleiras de seus clientes. <a href="https://www.kaggle.com/c/grupo-bimbo-inventory-demand/">Grupo Bimbo Inventory Demand</a></p>
<p>Os pães do tipo tortilha da marca <a href="https://rap10.com.br/">Rap10</a> conhecida no Brasil são produtos do Grupo Bimbo</p>
<p><img src="rap10.png" style="width:50.0%" /></p>
</div>
<div id="avaliação" class="section level1">
<h1><span class="header-section-number">2</span> Avaliação</h1>
<p>A métrica para essa competição é Raiz Quadrada do Erro Logarítmico Médio Quadrático - RMSLE.</p>
<p>RMSLE é calculado com a seguinte fórmula: <span class="math display">\[
\epsilon = \sqrt {\frac{1}{n} \sum_{i=1}^n (\log(p_i + 1) - \log(a_i+1))^2}
\]</span> Onde:</p>
<p><span class="math inline">\(\epsilon\)</span> é o valor RMSLE (score)<br />
<span class="math inline">\(\\n\)</span> é o número total de observações<br />
<span class="math inline">\(\\p_i\)</span> é a predição da demanda, e<br />
<span class="math inline">\(\\a_i\)</span> é a demanda real para <span class="math inline">\(\\i\)</span>.<br />
<span class="math inline">\(\log(x)\)</span> é o logaritmo natural de <span class="math inline">\(\\x\)</span></p>
<div id="arquivo-a-ser-submetido" class="section level2">
<h2><span class="header-section-number">2.1</span> Arquivo a ser submetido</h2>
<p>O dataset a ser submetido deverá ser composto por duas variáveis: id e Demanda_uni_equi. O id corresponde à variável id no dataset de teste. O arquivo deve conter um cabeçalho e ter o seguinte formato:</p>
<pre><code>id,Demanda_uni_equil
0,1
1,0
2,500
3,100
etc.</code></pre>
</div>
</div>
<div id="dados" class="section level1">
<h1><span class="header-section-number">3</span> Dados</h1>
<p>O conjunto de dados é formado por 9 semanas de transações de vendas no México. Caminhões entregam produtos aos vendedores todas as semanas.</p>
<p>A estrutura dos dados de treino é de 11 variáveis e 74 milhões de observações.</p>
<p>Cada transação consiste em vendas e devoluções. Devoluções são os produtos não vendidos e vencidos. A demanda por um produto em uma determinada semana é definida pelas vendas desta semana subtraídas pelo retorno da próxima semana.</p>
<div id="notas" class="section level2">
<h2><span class="header-section-number">3.1</span> Notas:</h2>
<ul>
<li>Pode haver produtos em teste que não existem em treino. Esse é o comportamento esperado dos dados de estoque, uma vez que novos produtos estão sendo vendidos o tempo todo. O modelo deve ser capaz de acomodar isso.</li>
<li>Existem Cliente_IDs duplicados no cliente_tabla, o que significa que um Cliente_ID pode ter vários NombreCliente que são muito semelhantes. Isso se deve ao fato do NombreCliente ter ruídos e não estar padronizado nos dados brutos, portanto, é necessário decidir como limpar e usar essas informações.</li>
<li>A demanda ajustada (Demanda_uni_equil) é sempre&gt; = 0, pois a demanda deve ser 0 ou um valor positivo. A razão porque Venta_uni_hoy - Dev_uni_proxima pode ter valores negativos é que os registros de retorno às vezes perduram por algumas semanas.</li>
</ul>
</div>
<div id="descrição-dos-arquivos" class="section level2">
<h2><span class="header-section-number">3.2</span> Descrição dos arquivos</h2>
<ul>
<li><strong>train.csv</strong> – dados de treino</li>
<li><strong>test.csv</strong> – dados de teste</li>
<li><strong>sample_submission.csv</strong> – arquivo exemplo de envio no formato correto</li>
<li><strong>cliente_tabla.csv</strong> - nomes de clientes (pode ser associado por Cliente_ID)</li>
<li><strong>producto_tabla.csv</strong> - nomes de produtos (pode ser associado por Producto_ID)</li>
<li><strong>town_state.csv</strong> - cidade e estado (pode ser associado por Agencia_ID)</li>
</ul>
</div>
<div id="dicionário-de-dados" class="section level2">
<h2><span class="header-section-number">3.3</span> Dicionário de dados</h2>
<table>
<thead>
<tr class="header">
<th align="left">Variável</th>
<th align="left">Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Semana</strong></td>
<td align="left">Número da semana (de quinta a quarta)</td>
</tr>
<tr class="even">
<td align="left"><strong>Agencia_ID</strong></td>
<td align="left">ID do centro de distribuição</td>
</tr>
<tr class="odd">
<td align="left"><strong>Canal_ID</strong></td>
<td align="left">ID do canal de vendas</td>
</tr>
<tr class="even">
<td align="left"><strong>Ruta_SAK</strong></td>
<td align="left">ID da rota (várias rotas = Centro de distribuição)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Cliente_ID</strong></td>
<td align="left">ID do cliente</td>
</tr>
<tr class="even">
<td align="left"><strong>Producto_ID</strong></td>
<td align="left">ID do produto</td>
</tr>
<tr class="odd">
<td align="left"><strong>Venta_uni_hoy</strong></td>
<td align="left">Unidades de vendas esta semana (inteiro)</td>
</tr>
<tr class="even">
<td align="left"><strong>Venta_hoy</strong></td>
<td align="left">Vendas esta semana (unidade: pesos)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Dev_uni_proxima</strong></td>
<td align="left">Unidades devolvidas na próxima semana (inteiro)</td>
</tr>
<tr class="even">
<td align="left"><strong>Dev_proxima</strong></td>
<td align="left">Valores devolvidos na próxima semana (unidade: pesos)</td>
</tr>
<tr class="odd">
<td align="left"><strong>Demanda_uni_equil</strong></td>
<td align="left">Demanda ajustada (inteiro) - variável alvo</td>
</tr>
</tbody>
</table>
</div>
<div id="diferenças-no-dicionário-de-dados-de-teste" class="section level2">
<h2><span class="header-section-number">3.4</span> Diferenças no dicionário de dados de teste</h2>
<table>
<thead>
<tr class="header">
<th align="left">Variável</th>
<th align="left">Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>ID</strong></td>
<td align="left">Variável adicional para identificar a previsão (inteiro)</td>
</tr>
<tr class="even">
<td align="left"><strong>Venta_uni_hoy</strong></td>
<td align="left">Não existe</td>
</tr>
<tr class="odd">
<td align="left"><strong>Venta_hoy</strong></td>
<td align="left">Não existe</td>
</tr>
<tr class="even">
<td align="left"><strong>Dev_uni_proxima</strong></td>
<td align="left">Não existe</td>
</tr>
<tr class="odd">
<td align="left"><strong>Dev_proxima</strong></td>
<td align="left">Não existe</td>
</tr>
<tr class="even">
<td align="left"><strong>Demanda_uni_equil</strong></td>
<td align="left">Não existe - variável alvo</td>
</tr>
</tbody>
</table>
</div>
<div id="dados-em-outros-datasets" class="section level2">
<h2><span class="header-section-number">3.5</span> Dados em outros datasets</h2>
<table>
<thead>
<tr class="header">
<th align="left">Variável</th>
<th align="left">Descrição</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><strong>Town</strong></td>
<td align="left">Código e nome da cidade (em <strong>town_state.csv</strong>)</td>
</tr>
<tr class="even">
<td align="left"><strong>State</strong></td>
<td align="left">Nome do estado (em <strong>town_state.csv</strong>)</td>
</tr>
<tr class="odd">
<td align="left"><strong>NombreCliente</strong></td>
<td align="left">Nome do cliente (em <strong>cliente_tabla.csv</strong>)</td>
</tr>
<tr class="even">
<td align="left"><strong>NombreProducto</strong></td>
<td align="left">Nome do produto (em <strong>producto_tabla.csv</strong>)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="pacotes-necessários" class="section level1">
<h1><span class="header-section-number">4</span> Pacotes necessários</h1>
<pre class="r"><code># Manipulação de dados
library(data.table)
library(dplyr)
library(stringr)
library(DT)

# Gráficos
library(ggplot2)
library(treemap)

# Tabelas
library(kableExtra)</code></pre>
</div>
<div id="carga-dos-dados" class="section level1">
<h1><span class="header-section-number">5</span> Carga dos dados</h1>
<p>Os datasets são grandes, então usaremos <strong>fread</strong> do pacote <strong>data.table</strong>.</p>
<p>As variáveis <strong>Agencia_ID</strong>, <strong>Canal_ID</strong>, <strong>Ruta_SAK</strong>, <strong>Cliente_ID</strong> e <strong>Producto_ID</strong> são categóricas, porém estão como inteiros, o que é inadequado para pacotes gráficos e a maioria delas tem grande quantidade de valores únicos, então serão carregadas como string.</p>
<pre class="r"><code># Carrega o dataset de treino.
system.time(treino &lt;- fread(&quot;train.csv&quot;,na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                            select = c(&quot;Semana&quot;, &quot;Agencia_ID&quot;, &quot;Canal_ID&quot;,
                                       &quot;Ruta_SAK&quot;, &quot;Cliente_ID&quot;, &quot;Producto_ID&quot;,
                                       &quot;Venta_uni_hoy&quot;,&quot;Venta_hoy&quot;,
                                       &quot;Dev_uni_proxima&quot;, &quot;Dev_proxima&quot;,
                                       &quot;Demanda_uni_equil&quot;),
                             colClasses = c(Semana = &quot;numeric&quot;,
                                            Agencia_ID = &quot;character&quot;,
                                            Canal_ID = &quot;character&quot;,
                                            Ruta_SAK = &quot;character&quot;,
                                            Cliente_ID = &quot;character&quot;,
                                            Producto_ID = &quot;character&quot;, 
                                            Venta_uni_hoy = &quot;numeric&quot;,
                                            Venta_hoy = &quot;numeric&quot;, 
                                            Dev_uni_proxima = &quot;numeric&quot;,
                                            Dev_proxima = &quot;numeric&quot;, 
                                            Demanda_uni_equil = &quot;numeric&quot;)))</code></pre>
<pre><code>##    user  system elapsed 
##  45.630   1.834  16.753</code></pre>
<pre class="r"><code># Carrega o dataset de teste.
system.time(teste &lt;- fread(&quot;test.csv&quot;, na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                           select = c(&quot;id&quot;, &quot;Semana&quot;, &quot;Agencia_ID&quot;, &quot;Canal_ID&quot;,
                                      &quot;Ruta_SAK&quot;, &quot;Cliente_ID&quot;,  &quot;Producto_ID&quot;),
                           colClasses = c(id = &quot;character&quot;,
                                          Semana = &quot;numeric&quot;,
                                          Agencia_ID = &quot;character&quot;,
                                          Canal_ID = &quot;character&quot;,
                                          Ruta_SAK = &quot;character&quot;,
                                          Cliente_ID = &quot;character&quot;,
                                          Producto_ID = &quot;character&quot;)))</code></pre>
<pre><code>##    user  system elapsed 
##  10.754   0.223   7.275</code></pre>
<pre class="r"><code># Carrega o cadastro de clientes.
clientes &lt;- fread(&quot;cliente_tabla.csv&quot;, na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                    encoding = &quot;UTF-8&quot;,select = c(&quot;Cliente_ID&quot;,&quot;NombreCliente&quot;),
                           colClasses = c(Cliente_ID = &quot;character&quot;,
                                          NombreCliente = &quot;character&quot;))

# Carrega o cadastro de produtos.
produtos &lt;- fread(&quot;producto_tabla.csv&quot;, na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                    encoding = &quot;UTF-8&quot;,select = c(&quot;Producto_ID&quot;,&quot;NombreProducto&quot;),
                           colClasses = c(Producto_ID = &quot;character&quot;,
                                          NombreProducto = &quot;character&quot;))

# Carrega o cadastro de agencias, cidadese e estados.
town_state &lt;- fread(&quot;town_state.csv&quot;, na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                    encoding = &quot;UTF-8&quot;,select = c(&quot;Agencia_ID&quot;,&quot;Town&quot;,&quot;State&quot;),
                           colClasses = c(Agencia_ID = &quot;character&quot;,
                                          Town = &quot;character&quot;,
                                          State = &quot;character&quot;))</code></pre>
<div id="amostra-com-50-mil-observações" class="section level2">
<h2><span class="header-section-number">5.1</span> Amostra com 50 mil observações</h2>
<p>Utilizaremos amostra porque o conjunto de dados é muito grande. A geração de gráficos ficará mais rápida.</p>
<pre class="r"><code>treino_sample &lt;- sample_n(treino, 5e4)</code></pre>
</div>
</div>
<div id="datasets-auxiliares" class="section level1">
<h1><span class="header-section-number">6</span> Datasets auxiliares</h1>
<p>Criaremos datasets com agregações e sumarizações para auxiliar na compreensão dos dados.</p>
<div id="top-100-centros-de-distribuição" class="section level2">
<h2><span class="header-section-number">6.1</span> Top 100 Centros de distribuição</h2>
<pre class="r"><code>system.time(agencia_t100 &lt;-
  treino %&gt;%
  group_by(Agencia_ID) %&gt;% 
  summarise(Unidade = sum(Venta_uni_hoy),
            Valor = sum(Venta_hoy),
            UnidadeDevolv = sum(Dev_uni_proxima)) %&gt;% 
  mutate(TaxaDevolv = UnidadeDevolv / (Unidade + UnidadeDevolv)) %&gt;%
  arrange(desc(Valor)) %&gt;%
  inner_join(town_state, by=&quot;Agencia_ID&quot;))</code></pre>
<pre><code>##    user  system elapsed 
##   1.695   0.516   2.213</code></pre>
<pre class="r"><code>agencia_t100 &lt;- agencia_t100[1:100, ]</code></pre>
</div>
<div id="canais-de-vendas" class="section level2">
<h2><span class="header-section-number">6.2</span> Canais de vendas</h2>
<pre class="r"><code># Distribuição por canal
system.time(canal &lt;-
  treino %&gt;%
  group_by(Canal_ID) %&gt;% 
  summarise(Unidade = sum(Venta_uni_hoy),
            Valor = sum(Venta_hoy),
            UnidadeDevolv = sum(Dev_uni_proxima)) %&gt;% 
  mutate(TaxaDevolv = UnidadeDevolv / (Unidade + UnidadeDevolv)) %&gt;%
  arrange(desc(Valor)))</code></pre>
<pre><code>##    user  system elapsed 
##   1.589   0.620   2.210</code></pre>
</div>
<div id="top-100-rotas" class="section level2">
<h2><span class="header-section-number">6.3</span> Top 100 Rotas</h2>
<pre class="r"><code># Distribuição por rota
system.time(rota_t100 &lt;-
  treino %&gt;%
  group_by(Ruta_SAK) %&gt;% 
  summarise(Unidade = sum(Venta_uni_hoy),
            Valor = sum(Venta_hoy),
            UnidadeDevolv = sum(Dev_uni_proxima)) %&gt;% 
  mutate(TaxaDevolv = UnidadeDevolv / (Unidade + UnidadeDevolv)) %&gt;%
  arrange(desc(Valor)))</code></pre>
<pre><code>##    user  system elapsed 
##   1.645   0.625   2.270</code></pre>
<pre class="r"><code>rota_t100 &lt;- rota_t100[1:100, ]</code></pre>
</div>
<div id="top-100-clientes" class="section level2">
<h2><span class="header-section-number">6.4</span> Top 100 Clientes</h2>
<pre class="r"><code># Top 100 Clientes
system.time(cliente_t100 &lt;-
  treino %&gt;%
  group_by(Cliente_ID) %&gt;% 
  summarise(Unidade = sum(Venta_uni_hoy),
            Valor = sum(Venta_hoy),
            UnidadeDevolv = sum(Dev_uni_proxima)) %&gt;% 
  mutate(TaxaDevolv = UnidadeDevolv / (Unidade + UnidadeDevolv)) %&gt;%
  inner_join(clientes, by=&quot;Cliente_ID&quot;) %&gt;%  arrange(desc(Valor)))</code></pre>
<pre><code>##    user  system elapsed 
##  13.909   0.239  14.149</code></pre>
<pre class="r"><code>cliente_t100 &lt;- cliente_t100[1:100, ]</code></pre>
</div>
<div id="top-100-produtos" class="section level2">
<h2><span class="header-section-number">6.5</span> Top 100 Produtos</h2>
<pre class="r"><code># Top 100 Produtos
system.time(produto_t100 &lt;- treino %&gt;% group_by(Producto_ID) %&gt;%
  summarise(Unidade = sum(Venta_uni_hoy),
            Valor = sum(Venta_hoy),
            UnidadeDevolv = sum(Dev_uni_proxima)) %&gt;% 
  mutate(TaxaDevolv = UnidadeDevolv / (Unidade + UnidadeDevolv)) %&gt;%
  inner_join(produtos, by=&quot;Producto_ID&quot;) %&gt;%
  arrange(desc(Valor)))</code></pre>
<pre><code>##    user  system elapsed 
##   2.712   0.425   3.136</code></pre>
<pre class="r"><code>produto_t100 &lt;- produto_t100[1:100, ]</code></pre>
</div>
<div id="marcas" class="section level2">
<h2><span class="header-section-number">6.6</span> Marcas</h2>
<p>Em um exame preliminar na variável NombreProducto percebemos existir um padrão que indicam sua marca. O padrão é composto por duas ou três letras maiúsculas precedendo o código do produto repetido nos últimos caracteres de sua descrição.</p>
<pre class="r"><code># Criar nova variável com as marcas constantes na variável NombreProducto

# Função para extrair o final da string, composta por marca (com duas ou três
# letras), um espaço em branco e números corespondentes ao código de produto.

substrFinal &lt;- function(x){
  substr(x, nchar(x)-nchar(str_extract(x,&quot;\\b\\d+$&quot;))-3, nchar(x))
}

# Cria a variável marca
produtos$Marca &lt;- str_extract(substrFinal(produtos$NombreProducto),&quot;[A-Z]+&quot;)

# Existe um produto denominado &quot;NO IDENTIFICADO&quot;, quando extraimos as últimas
# três letras, seguindo o padrão das demais, ficou como a marca &quot;ADO&quot;.
# Outros produtos com valores ausentes serão atribuídos a essa marca fictícia. 
produtos$Marca[is.na(produtos$Marca)] &lt;- &quot;ADO&quot;

# Distribuição por marcas
marcas &lt;- treino %&gt;% inner_join(produtos, by=&quot;Producto_ID&quot;) %&gt;% 
  group_by(Marca) %&gt;%
  summarise(Unidade = sum(Venta_uni_hoy),
            Valor = sum(Venta_hoy),
            UnidadeDevolv = sum(Dev_uni_proxima)) %&gt;% 
  mutate(TaxaDevolv = UnidadeDevolv / (Unidade + UnidadeDevolv)) %&gt;%
  arrange(desc(Valor))</code></pre>
</div>
</div>
<div id="amostras-dos-dados" class="section level1 tabset">
<h1><span class="header-section-number">7</span> Amostras dos dados</h1>
<p>Os datasets originais serão exibidos por amostras aleatórias com 100 observações. Os datasets auxiliares exibirão 100 observações em ordem decrescente do valor total de vendas.</p>
<p>O dataset de treino tem onze variáveis com nomes longos, então será apresentado com abreviaturas para evitar barra de rolagem horizontal na página.</p>
<div id="treino" class="section level2">
<h2><span class="header-section-number">7.1</span> Treino</h2>
<pre class="r"><code># Exibe amostra
# Condensa os nomes das variáveis para melhor exibir na página
names_cond &lt;- c(&#39;Sem&#39;,&#39;AgID&#39;,&#39;ChID&#39;,&#39;Ruta&#39;,&#39;CliID&#39;,&#39;ProdID&#39;,&#39;VenUni&#39;,
                &#39;VenHoy&#39;,&#39;DevUni&#39;,&#39;DevProx&#39;,&#39;DemEq&#39;)

datatable(sample_n(treino, 100) %&gt;% arrange(Semana),
          class=&quot;table-condensed&quot;,
          colnames = names_cond,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
))</code></pre>
<div id="htmlwidget-dfb2b3fd154157f896e2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dfb2b3fd154157f896e2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9],["1419","1222","2057","1629","1625","2018","1615","3217","1635","1625","4040","1636","1612","1153","1227","2213","1914","2038","2045","3229","1339","1279","1219","1439","2072","1213","1461","2030","2218","1339","2013","22362","1471","2214","1312","1963","4063","2629","1620","1441","22560","1140","4010","25699","1618","1340","2034","1153","1968","1337","2237","1120","2264","1111","1420","2220","1232","1443","1622","1628","1954","2031","1633","1123","4010","22362","1121","1538","2018","2088","2080","1451","1441","4010","1311","3217","1970","1534","3214","1656","1351","2017","2045","2653","1245","1279","1117","1112","1611","3217","2055","2019","2019","1382","4049","2653","2043","2263","1245","1451"],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","7","1","7","1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","4","1","4","1","1","1","1","1","1","1","1","1","1","1","2","4","1","1","1","1","1","1","1","1","1","1","1","1","1","1","7","1","1","1","1","1","1","1","4","1","1","1","1","1","4"],["1073","1419","1603","1005","1290","2863","1244","4410","2054","1256","5501","2107","2821","4428","1018","1242","2156","1216","4413","3301","1104","3309","1024","2814","1153","1416","2808","2152","2112","1213","2810","1237","1133","1201","2860","1267","1532","2152","5007","1037","1221","1421","1171","1207","1261","1064","1130","1419","1218","1131","4504","1060","4105","1411","5503","6602","1205","4706","1261","1264","2842","1216","1001","2114","1265","1231","4401","2050","1224","1561","6608","1265","1236","2115","2012","1001","1102","1212","2130","1105","1287","1282","1251","2003","1014","3902","1456","1606","1010","1015","1052","1212","1007","6601","1041","2016","1250","1126","2805","4952"],["179467","43213","4535326","85867","1475313","1645641","4444482","1058292","898464","424227","425999","1691963","490048","2132366","8885","4476444","96632","2221954","270585","1639742","44985","1217200","4588943","1097421","1353485","1530121","2501316","4711208","1769579","1599981","2295537","3504136","4539600","1785310","2464085","1789347","723129","2289137","319342","2316289","348195","713655","209688","4129549","2277359","2253222","1287382","1082462","944717","1376932","2232087","1670778","97373","75070","175673","1175158","4561147","2144891","485170","168686","886409","257095","684724","201118","4548414","7809500","1124934","1833133","4613829","3965467","697520","4512227","4320036","4375153","1835092","170046","633615","4346443","561601","741989","2172160","1020812","942890","2219426","2266353","2201333","2093169","328225","194278","111225","4655841","1890576","718420","1129686","128854","4411324","240771","360096","340773","4286459"],["34892","1272","1146","2233","1109","31310","1109","43067","43065","2425","43000","43058","30549","43084","1150","1309","36602","1150","43274","3894","31423","32393","3631","30575","1250","1216","43307","36301","30571","31423","36745","1146","43251","34868","43274","1242","46876","31310","36960","34204","41843","41843","43202","43118","1278","73","1309","1064","46183","35651","1240","46772","35452","1309","32861","5000","1309","43307","2233","1278","43274","1284","48077","36748","43197","1216","43066","5337","1242","33680","1232","43207","43197","31507","43274","1109","48805","1240","35309","1242","1284","1309","1216","43069","31307","32936","35651","4280","1182","1129","1125","1109","4767","5354","43179","35484","1250","47840","31512","43196"],[1,2,1,6,1,33,2,3,1,7,6,1,2,2,24,2,5,12,3,3,6,3,6,2,7,2,6,3,3,1,2,2,1,10,3,3,184,1,2,1,9,6,5,6,10,1,9,3,2,8,9,8,2,2,2,10,2,41,2,14,2,6,1,1,2,1,6,1,6,12,6,20,2,3,1,5,10,3,5,8,8,1,2,5,1,2,4,4,16,13,3,1,1,2,4,7,2,6,2,14],[16,20.94,21.39,119.64,15.01,206.25,30.02,28.89,6.76,31.5,22.2,9.35,10.76,16.3,335.04,13.52,26.9,167.52,15.57,28.05,64.14,9.06,98.1,12.5,53.48,16.76,31.68,18.45,20.82,10.69,23.06,42.78,10.47,30.2,15.57,22.92,1558.48,6.25,17.78,18.86,61.74,41.16,41.9,63.36,45,21.32,60.84,50.01,34.34,60,75.42,71.36,8.88,13.52,10.92,58.4,13.52,206.64,39.88,63,10.38,18.12,14.26,11.53,16.76,8.38,57.78,8.15,45.84,268.92,112.5,60.4,16.76,18.75,5.19,75.05,52.8,25.14,31.25,61.12,24.16,6.76,16.76,37.05,14.79,14.08,30,24,223.04,228.8,28.8,15.01,14.79,21.84,38.4,52.5,15.28,48,19.98,118.3],[0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,15.01,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,2,1,6,1,33,1,3,1,7,6,1,2,2,24,2,5,12,3,3,6,3,6,2,7,2,6,3,3,1,2,2,1,10,3,3,184,1,2,1,9,6,5,6,10,1,9,3,2,8,9,8,2,2,2,10,2,41,2,14,2,6,1,1,2,1,6,1,6,12,6,20,2,3,1,5,10,3,5,8,8,1,2,5,1,2,4,4,16,13,3,1,1,2,4,7,2,6,2,14]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Sem<\/th>\n      <th>AgID<\/th>\n      <th>ChID<\/th>\n      <th>Ruta<\/th>\n      <th>CliID<\/th>\n      <th>ProdID<\/th>\n      <th>VenUni<\/th>\n      <th>VenHoy<\/th>\n      <th>DevUni<\/th>\n      <th>DevProx<\/th>\n      <th>DemEq<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"className":"dt-right","targets":[1,7,8,9,10,11]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="teste" class="section level2">
<h2><span class="header-section-number">7.2</span> Teste</h2>
<pre class="r"><code>datatable(sample_n(teste, 100) %&gt;% arrange(Semana),
          class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
))</code></pre>
<div id="htmlwidget-3825def648d425c831c5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3825def648d425c831c5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["3384317","5752056","1463778","6212342","4746708","2484936","3817559","6600262","5291144","5347951","3311261","4118975","2076544","1996331","853863","3052772","6452957","4564608","3217271","6654456","3508645","2079371","1377706","3276347","1047907","2317008","4170859","5555494","3441120","876572","6343865","66609","6867199","5152944","6228708","4576239","6389256","5847360","42960","2152736","1691134","4573012","714739","2771583","6596660","6821868","3103933","4452681","2638360","6279090","1430593","3702053","3229637","4191650","6838957","3433021","5266256","1125256","44056","4086648","1951695","1080192","4884633","586900","2130717","4450183","2826104","5352432","955395","3972252","1690101","1814106","3235650","1070596","2901697","1695609","4272514","1449363","1993681","2045151","2919168","5965034","4424412","1239267","2770424","966736","708106","3392304","2961717","1361968","4062887","3763626","6210535","4526742","358884","4011757","3360747","245099","5556793","6476618"],[10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11],["1120","1121","2012","1113","1611","1555","1366","1419","1629","2037","24539","1235","2242","1616","1168","2229","2015","1684","2239","1220","1331","1366","2012","2031","1334","1635","1334","2214","2233","3212","1914","1629","22187","1335","3213","1223","2235","1236","1217","1549","2060","1130","1637","1952","1911","1120","2230","1970","1312","1622","1245","1556","4049","1628","1942","2071","1533","1347","2233","1213","2034","2024","2024","1441","23719","1625","1351","1170","1614","1213","1622","1219","25759","1330","1911","2034","1374","1331","1611","2060","2012","1556","1471","1351","1153","1147","2230","1963","1936","1215","1912","1215","1453","1245","1471","1623","1224","2239","1914","1471"],["1","1","1","1","1","1","1","1","1","1","1","1","1","1","2","1","1","11","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","1","11","1","1","1","1","1","1","1","1","1","1","1","1","4","1","1","1","1","1","1","1","1","4","1","1","1","1","1","1","1","1","4","1","1","1","1","1","1","1","1","1","1","1","1","1","1"],["1054","1018","2007","1005","1274","1026","1252","1082","1112","1106","2801","1001","2904","2813","2","2801","1104","5706","1160","1606","2105","1054","1171","2802","1215","1018","1210","1111","2002","1418","2157","1258","2858","1254","1008","1076","1206","1241","1042","1141","1213","1601","2825","1112","1277","1471","1217","1222","2159","2879","1224","1255","1038","4457","3935","1157","1201","2161","2801","1412","4406","2110","4510","1231","1279","2863","2151","6608","1127","1420","1058","2118","2815","1264","1057","2185","6608","1010","1007","1101","2825","1007","1029","2042","1606","6604","1106","1203","1159","2825","2109","1416","2135","1214","1203","2131","1611","2802","1234","1139"],["1955004","1548195","13690","1662178","4492819","1744615","2253513","1152062","88391","265593","1147394","109453","1521158","719661","19265","4304921","5882517","97207","517312","792027","196026","556381","9521398","2012301","1146084","1906067","4196560","303174","344614","999858","243191","175926","2249097","337901","2120376","391307","2336874","2320688","4550030","31589","4175494","730064","860892","1441314","1388538","1268408","805881","706692","3000038","4657321","8264702","2253322","1877526","88754","4396930","4471490","4477772","2229943","4587741","886495","252674","1502255","2364619","1262198","1294000","699105","1007653","4598993","320577","4242960","292564","1569683","713343","1799063","136862","249305","401312","369639","1910765","228894","1209543","623708","178846","119372","1012302","2175693","549314","1944968","2012958","4583214","597094","203803","1730140","1197167","2303844","681827","441774","917827","97571","4491739"],["40747","3631","43147","3631","1216","36287","1150","34215","41938","1230","43069","1146","35303","35305","31467","3333","1309","30531","48417","4280","40930","1125","972","35305","1238","1146","1309","35651","37057","1220","36337","1216","30532","2425","3631","3144","1232","1277","4910","43203","1232","4245","35309","1277","2425","1284","1182","41843","32940","37361","45143","32394","46876","31512","35484","43203","43207","30532","35307","1309","35484","30532","41938","36711","34868","43316","31467","1230","35651","3270","1109","31588","30532","1146","1150","35305","5380","1126","1146","1238","43058","43187","34264","43084","35452","4767","1216","73","1216","37361","37361","35651","35309","34868","43204","30569","35144","32936","2233","43398"]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>Semana<\/th>\n      <th>Agencia_ID<\/th>\n      <th>Canal_ID<\/th>\n      <th>Ruta_SAK<\/th>\n      <th>Cliente_ID<\/th>\n      <th>Producto_ID<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="centro-de-distribuição" class="section level2">
<h2><span class="header-section-number">7.3</span> Centro de distribuição</h2>
<pre class="r"><code>datatable(sample_n(town_state, 100) %&gt;% arrange(Agencia_ID),
          class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20)
))</code></pre>
<div id="htmlwidget-3a57bfa2e4465088727a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3a57bfa2e4465088727a">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["1112","1122","1124","1139","1156","1211","1213","1216","1228","1229","1232","1236","1243","1277","1336","1340","1348","1354","1359","1363","1374","1383","1385","1478","1491","1535","1539","1544","1552","1558","1564","1580","1581","1602","1613","1626","1653","1659","1660","1668","1669","1685","1939","1971","1973","20049","2012","20139","2014","20149","20179","20369","2037","2038","2040","2043","2062","2077","2081","2087","20929","2095","2096","21569","21619","21649","21779","21869","21889","2214","2229","2243","2248","2251","2256","2265","22659","2267","2269","2274","2282","23009","23559","23729","23739","23809","23829","23969","24189","24769","24789","25209","25669","25689","25709","25769","2628","3211","4082","4089"],["2004 AG. CUAUTITLAN","2019 AG. XALOSTOC","2021 AG. XOCHIMILCO 2","2013 AG. MEGA NAUCALPAN","2018 AG. TEPALCATES 2","2027 AG. VALLEJO","2041 AG. TULTITLAN","2007 AG. LA VILLA","2013 AG. MEGA NAUCALPAN","2056 PUEBLA NORTE MARINELA","2059 Queretaro Balvanera","2056 PUEBLA NORTE MARINELA","2065 TOLUCA CENTRO","2089 AG. AZCAPOTZALCO INSTITUCIONALES","2269 PUERTO VALLARTA BIMBO","2275 TEPIC BIMBO","2256 CD. MANTE","2272 SAN LUIS REY","2275 TEPIC BIMBO","2321 ZACATECAS MARINELA","2251 AGUASCALIENTES NORTE","2309 NORTE","2269 PUERTO VALLARTA BIMBO","2515 CAVAZOS","2462 JUAREZ BIMBO","2565 NAVOJOA","2555 ENSENADA II","2561 LOS MOCHIS","2574 TIJUANA PACIFICO","2563 MEXICALI PONIENTE","2561 LOS MOCHIS","2305 MAZATLAN BIMBO","2290 DURANGO BIMBO","2417 ZACATLAN","2361 ORIZABA","2377 VERACRUZ SUR MLA","2416 PACHUCA II","2364 PUEBLA NORTE BIMBO","2416 PACHUCA II","2376 CONVENIENCIA VERACRUZ SUR","2355 JALAPA I","2372 AG.TULANCINGO","2269 PUERTO VALLARTA BIMBO","2285 CD. CONSTITUCION","2576 GUERRERO NEGRO","2004 AG. CUAUTITLAN","2176 TOLUCA SAN ANTONIO","2013 AG. MEGA NAUCALPAN","2151 ACAPULCO ESCENICA","2014 AG. NEZA","2017 AG. SANTA CLARA","2036 APIZACO MARINELA","2153 APATZINGAN","2164 LAZARO CARDENAS","2181 ZIHUATANEJO","2156 CELAYA INDUSTRIAL WONDER","2186 LAGOS DE MORENO","2300 LEON MILENIUM","2081 NAUCALPAN II","2087 AG. TIZAYUCA","2092 AG. SANTA CLARA AUTOSERVICIOS","2175 TOLUCA AEROPUERTO","2301 CUBILETE","2156 CELAYA INDUSTRIAL WONDER","2161 IRAPUATO GUADALUPE","2164 LAZARO CARDENAS","2177 AGENCIA SUANDY","2186 LAGOS DE MORENO","2188 MARAVATIO","2393 MERIDA SUR","2386 COATZACOALCOS MLA.","2381 CANCUN_BM","2399 TAPACHULA","2395 PLAYA DEL CARMEN","2381 CANCUN_BM","2396 RUIZ CORTINEZ","2265 MATEHUALA BIMBO","2382 CARDENAS","2384 CIUDAD DEL CARMEN","2402 TUXTLA","2395 PLAYA DEL CARMEN","2300 LEON MILENIUM","2355 JALAPA I","2372 AG.TULANCINGO","2373 TUXPAM","2380 CAMPECHE","2382 CARDENAS","2396 RUIZ CORTINEZ","2418 COMALCALCO","2476 SABINAS","2478 SAN NICOLAS","2520 HERMOSILLO SUR","2566 NOGALES_BW","2568 SAN LUIS R.C.","2570 SANTA ANA","2576 GUERRERO NEGRO","2301 CUBILETE","2029 AG.IZTAPALAPA 2","2493 MITRAS","2465 LAREDO"],["ESTADO DE MÉXICO","ESTADO DE MÉXICO","MÉXICO, D.F.","ESTADO DE MÉXICO","MÉXICO, D.F.","MÉXICO, D.F.","ESTADO DE MÉXICO","MÉXICO, D.F.","ESTADO DE MÉXICO","PUEBLA","Queretaro de Arteaga","PUEBLA","ESTADO DE MÉXICO","MÉXICO, D.F.","JALISCO","NAYARIT","MICHOACÁN","SAN LUIS POTOSÍ","NAYARIT","ZACATECAS","AGUASCALIENTES","JALISCO","JALISCO","NUEVO LEÓN","CHIHUAHUA","SONORA","BAJA CALIFORNIA NORTE","SINALOA","BAJA CALIFORNIA NORTE","BAJA CALIFORNIA NORTE","SINALOA","SINALOA","DURANGO","PUEBLA","VERACRUZ","VERACRUZ","HIDALGO","PUEBLA","HIDALGO","VERACRUZ","VERACRUZ","HIDALGO","JALISCO","BAJA CALIFORNIA SUR","BAJA CALIFORNIA SUR","ESTADO DE MÉXICO","ESTADO DE MÉXICO","ESTADO DE MÉXICO","GUERRERO","ESTADO DE MÉXICO","ESTADO DE MÉXICO","TLAXCALA","MICHOACÁN","MICHOACÁN","GUERRERO","GUANAJUATO","JALISCO","GUANAJUATO","ESTADO DE MÉXICO","ESTADO DE MÉXICO","ESTADO DE MÉXICO","ESTADO DE MÉXICO","GUANAJUATO","GUANAJUATO","GUANAJUATO","MICHOACÁN","ESTADO DE MÉXICO","JALISCO","MICHOACÁN","YUCATÁN","VERACRUZ","QUINTANA ROO","CHIAPAS","QUINTANA ROO","QUINTANA ROO","TABASCO","SAN LUIS POTOSÍ","TABASCO","CAMPECHE","CHIAPAS","QUINTANA ROO","GUANAJUATO","VERACRUZ","HIDALGO","VERACRUZ","CAMPECHE","TABASCO","TABASCO","TABASCO","COAHUILA","NUEVO LEÓN","SONORA","SONORA","SONORA","SONORA","BAJA CALIFORNIA SUR","GUANAJUATO","MÉXICO, D.F.","NUEVO LEÓN","TAMAULIPAS"]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Agencia_ID<\/th>\n      <th>Town<\/th>\n      <th>State<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20],"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="clientes" class="section level2">
<h2><span class="header-section-number">7.4</span> Clientes</h2>
<pre class="r"><code>datatable(sample_n(clientes, 100) %&gt;% arrange(Cliente_ID),
          class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
))</code></pre>
<div id="htmlwidget-d16ff735329d68ad3ebf" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-d16ff735329d68ad3ebf">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["1003061","103681","1057820","1100786","122234","1275798","1278598","1356418","1361389","1369560","1413578","1453951","1528042","1541399","1546378","1589453","1601762","161297","1707193","1734884","1770163","1809929","1845108","1934677","1945129","1970021","1977842","199575","2031795","2055022","2055681","2072387","2087640","209094","2216272","2222300","2252735","2262256","2280889","229038","2349023","2365557","2372595","2378007","2403867","2431421","2433394","2435395","2480507","2486166","2492538","27414","297572","314134","321383","322263","325235","34580","346285","371249","392913","400187","404693","405209","407458","418764","4204512","4244196","4247575","428687","4298625","4362800","4413802","4528716","4552185","4559572","4585550","4598052","4616186","4645422","4664963","4672112","4672753","4762756","554600","578682","607218","634169","664675","7726000","7921243","7955795","7985125","817023","82454","829986","8668280","932285","967689","985790"],["CHELIS","JUAN DELGADILLO REYNOSO","SAN AGUSTIN","JAEL","MENCHACA","RESTAURANTE ATALAYA SA DE CV","ERENDIRA","EL SOL","MICKIS 3","HILDA HERMENEGILDO BUCIO","MAXI","MARIA GUADALUPE AVILA LLAMAS","MARINA GUILLEN AGUILAR","ABARROTES LA ESMERALDA","MISCELANEA YANERY","DEPOSITO SAN ISIDRO","ANA MARIA RODRIGUEZ MELENDEZ","LA ESQUINA","ABARROTES AVALOS","POLLERIA LA PAZ","DOÑA TERE","AMPLEACION AZTECA","CRISTI","ESC PRI LICENCIADO BENITO JUAREZ","SANTOS","JOSE OLIVA GALLEGOS","MARTHA LEDEZMA ZEPEDA","TERE","JERRY","MARISOL","MARIA DEL CARMEN PEREZ HURTADO","CARMEN GARCIA","COMODIN R 4411 AG 2057 SAN JUAN DEL RIO BCS","ROSAURA FLORES MERCADO","MODELO CENTRO","PUESTO DE TAMALES LA PAZ","SISTEMA MUNICIPAL PARA EL DESARROLLO INTEGRAL DE LA FAMILIA","PAPELERIA LOUGY","ABARROTES GENESIS","ABARROTES ELVIS","VERA","ERASMO LARA MACIAS","LA YUCATECA JARDINES DE CAUCEL","TERESA SERVIN","MISCELANEA LA ALBORADA","LA SUBIDITA","ERIKA RODRIGUEZ MATA","BENITO RODRIGUEZ","ABARROTES LA GUADALUPANA II","FAUSTINO DE LIRA AGUILAR","FRUTERIAS Y VERDURAS MOLINA","COMERCIAL MEXICANA CELAYA TECONOLOGICO GALERIAS","SECOS BURGER","MI PRIMA VERA","ABA CRUZ","LAS PALMAS","SAN MIGUEL","SUPER 10 20 DE NOVIEMBRE","OLY","PATRICIA CORTEZ","ABARR VIN Y LIC LA MODERNA","MARIA ISABEL MEDINA OJEDA","JONATHAN","LORE","MINI SUPER SILVA","EL CENTRO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","EL PADRINO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","NO IDENTIFICADO","ALEX","DICONSA","COMODIN R 1601 AG 3214 ECATEPEC WM","EL 13","LA CHIQUITA","ESMERALDA","ALBERTO CARPIO RAMIREZ","ENRIQUE REYES TORRES","FRANCISCO TAPIA HERNANDEZ","SEVERIANO ESPINOZA ESPINOZA","LA BALANZA","HERMINIA SILVA IBARRA","JORGE EDUARDO MAGALLANES RODRIGUEZ","VAZQUEZ","IGNACIO GONZALEZ","JOHN"]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Cliente_ID<\/th>\n      <th>NombreCliente<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="produtos" class="section level2">
<h2><span class="header-section-number">7.5</span> Produtos</h2>
<pre class="r"><code>datatable(sample_n(produtos, 100) %&gt;% arrange(Producto_ID),
          class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
))</code></pre>
<div id="htmlwidget-343d1f80f3fe1e2beb1a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-343d1f80f3fe1e2beb1a">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["1166","1272","2505","2808","30178","30235","30355","30408","30423","30556","30626","30888","31013","31170","31575","31977","322","32274","32363","325","32799","32862","33681","33768","33902","34083","34403","34737","34794","34958","34973","35014","3509","35182","35307","35413","35443","35454","35517","35524","35576","35828","35900","35921","36024","3606","36332","36341","36403","36539","36545","36748","36801","36899","36912","36989","36991","37000","37329","37519","37573","37617","42117","42470","42538","42672","43075","43097","43111","43181","43196","43197","43222","43241","43257","43377","46102","46117","46204","46231","46238","46288","4733","47882","47942","47949","47957","48033","48043","48250","4910","49185","49443","49495","49614","49996","5919","6507","7814","9197"],["Bollo Regular 2pq 30p McD BIM 1166","Conchas Chocolate 2p 120g BIM 1272","Mini Bigotes Chocolate 5p 65g SP TR 2505","Mantecadas Panera 16p 500g BIM 2808","Bran Frut Pina 6p 240g Var BIM 30178","Barritas Pina KC 8p 600g CU MLA 30235","Polvorones 113g MTB MLA 30355","Choco Roles Fresa 2p 67g CC MLA 30408","Silueta Fresa 6p 132g MTA BIM 30423","Suavicremas Vainilla 84g TAB MLA 30556","Rosca Reyes 430g TR 30626","Empanaditas Pina 20p Prom DH 30888","Gansi Premio 1p 50g MLA 31013","Tortilla Hna Hermosi 15p 410g DH 31170","Polvoroncitos Caseros 12p 195g TR 31575","Tost Maiz Clasic mas Salmas 308g CJM SAN 31977","Tuinky Fresas con Crema 2p WON 322","Duo Pan Doble Fibra MM 1134g BIM 32274","Duo Plativolos 148g MLA 32363","Tuinky Vainilla 3p 114g WON 325","Galleta Gansito 62g SP MTA MLA 32799","Chocochispas 80g SP TAB LAR 32862","Dutch Country 100pct Ajonjo 400g TAB WON 33681","Salmas 18p 108g CJM SAN 33768","Hot Nuts Multintenso 50g BAR 33902","Canelitas Escolar 20g MLA 34083","Tartina Zarzamora 2p 26g TR 34403","Tartinas Zarzamora 8p 104g SP CU TR 34737","Super Bollos 5in 8p 540g TNB WON 34794","Bolsa Mini Rocko Consumos 13g CU MLA 34958","Barritas Bisabor 20p 1340g CU MLA 34973","Lata Danesas Snoopy 150g GBI 35014","Paletina para Cafe NES 3509","Tartinas Fresa 8p 104g Prom TR 35182","Barritas Pina 75g Prom MLA 35307","Tartinas Fresa 4p 52g MTA TR 35413","Pan para la Comida 20p 225g CU BIM 35443","Chocotorro Fresa 1p 50g SP TAB MLA 35454","Canapinas 95g SP TAB LAR 35517","Galletas 2a Seleccion 1000g GBI 35524","Duo Barrita Fsa Barrita Pna 110g TAB MLA 35576","Medias Noches 12p 510g TNB BIM 35828","Canelitas Tentacion 8p 86g MTA MLA 35900","Costalito Surtido Rico 1000g GBI 35921","Pastilla Alka Sabor Miel 30 6g CU MP 36024","Tortilla Hna 750g 18p RW Sonora DH 3606","Deliciosas Chochitos MG 180g CR2 LAR 36332","Tubo Galleta Gansito MG 8p 215g CR2 MLA 36341","Duo Bigotes y Mini Doraditas 95g MTA TR 36403","Pan Integral 680g CU BIM 36539","Roles Canela 3p 180g Prom MTB BIM 36545","Polvorones Tubo 287g MTB MLA 36748","Hot Dog Inte Est Sonora 500g DIF MTA BIM 36801","Pan Tostado Mantequilla 210g TNB BIM 36899","Canelitas Navidad 60g CU MLA 36912","Combo Tost Clas mas Frijol 640g Prom SAN 36989","Deliciosas Coco 130g Tira LAR 36991","Triki Trakes Tubo 20p 174g SP2 CU MLA 37000","Pallet Principe KC 392g CU MLA 37329","Pan Blanco 640g Prom TNB BIM 37519","Deliciosas Chochochispas 204gPromCU LAR 37573","Te Hierbabuena 50 Sobres 150g MCM 37617","Valentones 20g CB2 BAR 42117","Tortillina Taquera de 30p 390g TR 42470","Barra Multigrano Nuez 12p 408g Cj BIM 42538","Takis Fuego 59g BAR 42672","Polvorones 4p 75g MTB MLA 43075","Totopos Redondo 350g MTA MR 43097","100pct Whole Wheat 680g MTA ORO 43111","Tortillinas 20p 510g MTA TR 43181","Roles Canela 2p 120g MTB BIM 43196","Roles Glass 2p 135g MTB BIM 43197","Galleta Molida 5Kg MTA LAR 43222","Panquecitos Gotas Paner 10p 700g MTA BIM 43241","Animalitos 2Kg MTA LAR 43257","Barra Multigrano Nuez 204g 6p MTA BIM 43377","Tortillinas 20p 510g TAB TR 46102","Tostado 210g TAB BIM 46117","Conchas 2p 120g TAB TR 46204","Submarinos Vainilla 3p 105g SP TAB MLA 46231","Rocko Tira 10p 44g TAB MLA 46238","Pan Molido 210g TAB BIM 46288","Bimkingo Jalapeno 86g LON 4733","Star Gum Menta Intensa 8g SKD 47882","Bollos Carls Jr sn Ajonj 12p 675g MTA SL 47942","Gansito Chocolate 52g MLA 47949","Tortilla Hna 750g 18p RW Sonora MTA DH 47957","Galleta Granel Classics Chocolate GBI 48033","Costalito 1200g GBI 48043","Pan Whole grain and flax 680g TAB ORO 48250","Empanizador Crujiente 175g BIM 4910","Totopo Chilaquiles 500g MR 49185","Pan Blanco 454g MTA SUN 49443","Tortillinas 22p 570g NTE MTA TR 49495","Raztachoc Vainilla 6p 40g Tira BIM 49614","Tostado Int 0pct Grasa Azuc 200g MTA WON 49996","Burritos Clasico 197g CU LON 5919","Bimkingo Clasico 135g CU LON 6507","Kranky 40g RIC 7814","Barritas Fresa 32g CU MLA 9197"],["BIM","BIM","TR","BIM","BIM","MLA","MLA","MLA","BIM","MLA","TR","DH","MLA","DH","TR","SAN","WON","BIM","MLA","WON","MLA","LAR","WON","SAN","BAR","MLA","TR","TR","WON","MLA","MLA","GBI","NES","TR","MLA","TR","BIM","MLA","LAR","GBI","MLA","BIM","MLA","GBI","MP","DH","LAR","MLA","TR","BIM","BIM","MLA","BIM","BIM","MLA","SAN","LAR","MLA","MLA","BIM","LAR","MCM","BAR","TR","BIM","BAR","MLA","MR","ORO","TR","BIM","BIM","LAR","BIM","LAR","BIM","TR","BIM","TR","MLA","MLA","BIM","LON","SKD","SL","MLA","DH","GBI","GBI","ORO","BIM","MR","SUN","TR","BIM","WON","LON","LON","RIC","MLA"]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Producto_ID<\/th>\n      <th>NombreProducto<\/th>\n      <th>Marca<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="top-100-centros-de-distribuição-1" class="section level2">
<h2><span class="header-section-number">7.6</span> Top 100 Centros de Distribuição</h2>
<pre class="r"><code>datatable(agencia_t100[, c(&quot;Agencia_ID&quot;, &quot;Town&quot;, &quot;State&quot;, &quot;Valor&quot;)] %&gt;%
            arrange(desc(Valor)), class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
)) %&gt;% formatRound(columns = c(&quot;Valor&quot;), digits = 2)</code></pre>
<div id="htmlwidget-8d6750507a512ee462dd" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8d6750507a512ee462dd">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["1129","1114","1142","1168","1911","4061","1312","1126","1351","1121","1912","1123","1116","2034","1122","1315","2013","1117","1220","1347","1120","1659","1222","2229","1219","1470","1588","1311","1111","1118","2237","4062","1945","2653","1914","1310","2211","1232","3213","2055","1119","1353","1340","22560","1419","2015","1137","1124","1138","4010","1130","1380","2012","1954","4046","2018","2030","2213","1955","1629","1614","4037","2061","1279","2250","1223","1127","2249","1334","2230","2032","1333","1586","4011","1227","2214","1153","1336","1463","1338","4040","1936","22187","2016","1215","1212","1420","1213","4063","2244","1471","1633","1245","1112","1631","1332","2057","2215","22362","4051"],["2011 AG. SAN ANTONIO","2029 AG.IZTAPALAPA 2","2013 AG. MEGA NAUCALPAN","2092 AG. SANTA CLARA AUTOSERVICIOS","2309 NORTE","2517 SENDERO AUTOSERVICIO","2278 ZAPOPAN BIMBO","2017 AG. SANTA CLARA","2252 AGUASCALIENTES SIGLO XXI","2016 AG. SAN LORENZO","2294 GUADALAJARA","2094 CHALCO_BM","2011 AG. SAN ANTONIO","2167 MORELIA LA HUERTA","2019 AG. XALOSTOC","2268 PALOMAR","2177 AGENCIA SUANDY","2001 AG. ATIZAPAN","2048 AG. IXTAPALUCA 1","2251 AGUASCALIENTES NORTE","2018 AG. TEPALCATES 2","2364 PUEBLA NORTE BIMBO","2088 AG. CEYLAN","2386 COATZACOALCOS MLA.","2042 AG. TEPOZOTLAN","2515 CAVAZOS","2573 TIJUANA GATO BRONCO","2273 SAN PEDRO","2002 AG. AZCAPOTZALCO","2007 AG. LA VILLA","2402 TUXTLA","2496 LA FE","2322 ZAMORA MADERO","2190 BI_SAN FRANCISCO DEL RINCON","2293 GRANJAS MARINELA","2260 GONZALEZ GALLO","2390 INDUSTRIAL","2059 Queretaro Balvanera","2027 AG. VALLEJO","2055 Pinotepa","2013 AG. MEGA NAUCALPAN","2293 GRANJAS MARINELA","2275 TEPIC BIMBO","2560 LAS TORRES","2467 LINCOLN","2154 ATLACOMULCO","2014 AG. NEZA","2021 AG. XOCHIMILCO 2","2015 AG. ROJO GOMEZ","2487 AEROPUERTO","2010 AG. LOS REYES","2330 TLAQUEPARQUE","2176 TOLUCA SAN ANTONIO","2288 CULIACAN BIMBO","2485 CHIHUAHUA MARINELA","2159 CHILPANCINGO","2165 LEON SAN JUAN BOSCO","2396 RUIZ CORTINEZ","2290 DURANGO BIMBO","2365 PUEBLA SUR BIMBO","2355 JALAPA I","2499 REYNOSA MARINELA","2175 TOLUCA AEROPUERTO","2041 AG. TULTITLAN","2410 CANCUN II","2070 AG. XOCHIMILCO 1","2003 AG. COACALCO","2393 MERIDA SUR","2259 FRESNILLO BIMBO","2382 CARDENAS","2155 CELAYA NORPONIENTE","2258 COLIMA BIMBO","2289 CULIACAN MARINELA","2493 MITRAS","2066 TOLUCA PONIENTE","2393 MERIDA SUR","2087 AG. TIZAYUCA","2269 PUERTO VALLARTA BIMBO","2458 GOMEZ PALACIO BIMBO","2274 TEPATITLAN BIMBO","2502 SALTILLO MARINELA","2300 LEON MILENIUM","2187 SALAMANCA","2157 CUAUTLA","2049 AG. IZTAPALAPA 1","2064 AG. TEPALCATES 1","2478 SAN NICOLAS","2041 AG. TULTITLAN","2455 CHIHUAHUA BIMBO","2396 RUIZ CORTINEZ","2516 ESCOBEDO","2360 OAXACA BIMBO","2036 APIZACO MARINELA","2004 AG. CUAUTITLAN","2372 AG.TULANCINGO","2255 CD GUZMAN","2057 PUEBLA SUR MARINELA","2392 MERIDA NORTE","2362 AG.PACHUCA","2488 JUAREZ"],["MÉXICO, D.F.","MÉXICO, D.F.","ESTADO DE MÉXICO","ESTADO DE MÉXICO","JALISCO","NUEVO LEÓN","JALISCO","ESTADO DE MÉXICO","AGUASCALIENTES","MÉXICO, D.F.","JALISCO","ESTADO DE MÉXICO","MÉXICO, D.F.","MICHOACÁN","ESTADO DE MÉXICO","JALISCO","ESTADO DE MÉXICO","ESTADO DE MÉXICO","ESTADO DE MÉXICO","AGUASCALIENTES","MÉXICO, D.F.","PUEBLA","MÉXICO, D.F.","VERACRUZ","ESTADO DE MÉXICO","NUEVO LEÓN","BAJA CALIFORNIA NORTE","JALISCO","MÉXICO, D.F.","MÉXICO, D.F.","CHIAPAS","NUEVO LEÓN","MICHOACÁN","GUANAJUATO","JALISCO","JALISCO","TABASCO","Queretaro de Arteaga","MÉXICO, D.F.","PUEBLA","ESTADO DE MÉXICO","JALISCO","NAYARIT","SONORA","NUEVO LEÓN","ESTADO DE MÉXICO","ESTADO DE MÉXICO","MÉXICO, D.F.","MÉXICO, D.F.","NUEVO LEÓN","ESTADO DE MÉXICO","JALISCO","ESTADO DE MÉXICO","SINALOA","CHIHUAHUA","GUERRERO","GUANAJUATO","TABASCO","DURANGO","PUEBLA","VERACRUZ","TAMAULIPAS","ESTADO DE MÉXICO","ESTADO DE MÉXICO","QUINTANA ROO","MÉXICO, D.F.","ESTADO DE MÉXICO","YUCATÁN","ZACATECAS","TABASCO","GUANAJUATO","COLIMA","SINALOA","NUEVO LEÓN","ESTADO DE MÉXICO","YUCATÁN","HIDALGO","JALISCO","DURANGO","JALISCO","COAHUILA","GUANAJUATO","GUANAJUATO","MORELOS","MÉXICO, D.F.","MÉXICO, D.F.","NUEVO LEÓN","ESTADO DE MÉXICO","CHIHUAHUA","TABASCO","NUEVO LEÓN","OAXACA","TLAXCALA","ESTADO DE MÉXICO","HIDALGO","JALISCO","PUEBLA","YUCATÁN","HIDALGO","CHIHUAHUA"],[66163785.86,62420319.8,62069566.97,46739790.62,40226634.3,31862378.89,31410683.28,30947328.58,30911017.05,29898290.06,29837553.49,28777951.16,27454357.63,27231420.69,27122584.66,27044002.77,27001891.52,26919320.11,26777069.44,26415181.75,25258048.66,25049186.36,24781384.74,24692156.53,24538872.97,24415524.86,24196984.8,24108701.3,24070591.72,24055678.5,24008491.84,23744169.58,23734289.95,23221578.46,23192314.31,22956978.02,22858082.45,22791702.13,22515213.64,22417530.33,22017344.08,21754597.84,21470576.88,21193288.37,21154189.39,21101277.7,21035580.04,20872875.89,20726924.95,20584240.95,20582431.95,20489066.55,20408444.69,20398227.38,20052074.76,19583899.89,19459782.9,19338957.02,19239966.86,19216743.58,19163990.25,19019382.82,18942397.78,18664370.88,18645272.17,18531909.5,18449045.85,18387218.24,18176079.53,18146787.85,18106334.31,17964147.86,17657639.32,17656096.84,17598749.67,17550032.1,17512581.13,17338029.6,17264623.22,17189360.81,17160443.79,17152843.09,17137024.13,17064663.29,17023591.68,16941024.05,16923523.23,16884718.66,16864790.92,16796122.56,16788054.99,16696650.77,16615256.23,16591688.43,16580586.79,16547515.77,16491648.97,16477783.73,16390982.29,16198174.85]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Agencia_ID<\/th>\n      <th>Town<\/th>\n      <th>State<\/th>\n      <th>Valor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\");\n  }"},{"className":"dt-right","targets":4},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
<div id="canais-de-vendas-1" class="section level2">
<h2><span class="header-section-number">7.7</span> Canais de vendas</h2>
<pre class="r"><code>datatable(canal[, c(&quot;Canal_ID&quot;, &quot;Valor&quot;)] %&gt;%
            arrange(desc(Valor)), class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
)) %&gt;% formatRound(columns = c(&quot;Valor&quot;), digits = 2)</code></pre>
<div id="htmlwidget-11888018c580b1773e78" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-11888018c580b1773e78">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9"],["1","2","4","5","11","7","8","6","9"],[3143719570.50991,940084793.79,471003920.03,172359548.77,165875147.3,119925188.61,41589248.23,28573289.01,1533783.84]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Canal_ID<\/th>\n      <th>Valor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\");\n  }"},{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
<div id="top-100-rotas-1" class="section level2">
<h2><span class="header-section-number">7.8</span> Top 100 Rotas</h2>
<pre class="r"><code>datatable(rota_t100[, c(&quot;Ruta_SAK&quot;, &quot;Valor&quot;)] %&gt;%
            arrange(desc(Valor)), class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
)) %&gt;% formatRound(columns = c(&quot;Valor&quot;), digits = 2)</code></pre>
<div id="htmlwidget-1dcfe5f8b5a57795ff0a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1dcfe5f8b5a57795ff0a">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["1001","1501","1002","6601","1003","1004","6602","6603","1005","1502","3001","6605","1201","6604","3002","1011","1006","1101","1007","1103","1102","6606","1504","1012","1203","1008","1202","1010","1503","1204","1013","1014","1104","1021","1205","3003","1206","3004","1505","1213","1212","1207","1051","1105","6607","1211","1009","1214","6608","1023","1022","1015","1208","1052","1053","6610","1507","6609","1508","3006","1106","1221","1016","1054","1222","1210","1506","1215","3005","1209","1601","1017","1024","1025","1112","1223","1216","3007","1224","1032","2101","1107","1111","1220","1509","1225","1511","1512","6611","1057","6612","2102","1018","1020","1056","3901","1113","1114","1151","1055"],[31026516.4,28934569.26,26788347.3,26522701.53,26429551.41,24556078.73,24183352.1,23241336.97,22858809.7,21239507.65,20548434.14,20383092.45,20353197.44,20238837.06,19954328.02,19512710.61,19331987.06,19252779.14,19234447.12,18465519.59,18249422.5,17612358.98,17597450.79,17564971.06,17278402.13,17091142.48,17086164.89,16910660.57,16670729.29,16593271.22,16593113.24,16551456.69,16475182.04,16385483.01,16124146.81,15892596.01,15876764.69,15407676.48,15296227.3,15139180.37,15090278.48,15086980.79,15067270.09,14933970.93,14929041.07,14684740.1,14456368.03,14369314.88,14104656.87,13683913.68,13681232.01,13635416.42,13629234.31,13626027.24,13623079.97,13459989.41,13424526,13057484.66,13049897.69,13033413.57,12959899.15,12952758.62,12677036.19,12618591.98,12580182.02,12546844.06,12532749.38,12405814.55,12389325.73,12356875.11,12065338.51,12060442.87,12055162.13,12036819.11,12022462.59,11777219.81,11663023.22,11524890.32,11403804.77,11393453.24,11377968.46,11340663.93,11253881.91,11164482.89,11012638.6,11008081.05,10942703.84,10937203.97,10908919.29,10849499.78,10722126.45,10652011.4,10633029.01,10620068.37,10613427.07,10558883.39,10469561.83,10468270.76,10450395.58,10413574.39]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Ruta_SAK<\/th>\n      <th>Valor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\");\n  }"},{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
<div id="top-100-clientes-1" class="section level2">
<h2><span class="header-section-number">7.9</span> Top 100 Clientes</h2>
<pre class="r"><code>datatable(cliente_t100[, c(&quot;Cliente_ID&quot;,&quot;NombreCliente&quot;,&quot;Valor&quot;)] %&gt;%
            arrange(desc(Valor)), class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
)) %&gt;% formatRound(columns = c(&quot;Valor&quot;), digits = 2)</code></pre>
<div id="htmlwidget-10809f8b4a990894a01d" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-10809f8b4a990894a01d">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["653378","653039","827594","652850","1216931","5903732","1200400","2502084","19260","60","19174","1093627","22534","17815","20959","16063","23849","932176","653124","20990","928089","26201","20577","20983","19215","17851","20626","22471","21115","688157","27964","48213","20591","1188056","22462","886620","45228","22533","1188055","24342","21021","21122","22107","24568","653037","812391","936660","36161","1379288","22555","22537","22861","45263","35853","20877","22482","22703","19480","54857","19189","1123492","22552","20903","44668","22726","31861","35667","29116","1188057","118901","674685","2082738","147513","25553","1705499","35693","24363","26815","10765","52863","1197666","1210852","20430","65","45863","1103561","35162","431380","20250","2387266","429138","48342","24468","1281689","80998","829567","936648","40511","22456","69854"],["PUEBLA REMISION","QUERETARO DE ARTEAGA REMISION","MC DONALDS ANTONIO CUAUTITLAN","JALISCO REMISION","OXXO TECNOLOGICO","WAL MART SUPER CENTER DOMINGO DIEZ CUERNAVACA","CHEDRAUI POLANCO","CEDIS CADENA COMERCIAL OXXO","WAL MART TEPEYAC","SAMS CLUB TOLUCA","WAL MART MIRAMONTES","SUPERAMA RIO MAYO","MEGA COMERCIAL MEXICANA MIXCOAC","WAL MART PLAZA ORIENTE","WAL MART LOMAS","WAL MART TLALPAN","WAL MART CLOUTHIER","UNILEVER DE MEXICO","TAMAULIPAS REMISION","MEGA COMERCIAL MEXICANA PILARES","SAMS CLUB TEPEYAC","WAL MART VERACRUZ","SAMS CLUB SAN JERONIMO","COSTCO POLANCO","WAL MART BUENAVISTA","WAL MART UNIVERSIDAD","WAL MART PERIFERICO SUR","COSTCO MIXCOAC","BODEGA AURRERA TORRES LINDAVISTA","SAMS CLUB UNIVERSIDAD","COSTCO COAPA","WAL MART AGUASCALIENTES","MEGA COMERCIAL MEXICANA SAN JERONIMO","CHEDRAUI UNIVERSIDAD","WAL MART PLATEROS","MEGA COMERCIAL MEXICANA LA SELVA","WAL MART CANCUN","WAL MART VILLA COAPA","CHEDRAUI VILLA COAPA","WAL MART SAN MANUEL","WAL MART CUITLAHUAC","WAL MART AZCAPOTZALCO","WAL MART TLAHUAC","WAL MART SAN LUIS POTOSI","OAXACA REMISION","MEGA COMERCIAL MEXICANA COYOACAN","WAL MART PLAZA EDUARDO MOLINA","OXXO PUEBLA FINSA","COSTCO TOLUCA","WAL MART TAXQUEÑA","WAL MART FELIX CUEVAS","WAL MART INTERLOMAS","WAL MART QUERETARO","CHEDRAUI XALAPA ANIMAS","WAL MART SATELITE","WAL MART CUAJIMALPA","MEGA COMERCIAL MEXICANA COAPA","WAL MART VALLARTA","WAL MART DEPORTIVA","WAL MART BALBUENA","WAL MART IRAPUATO GUANAJUATO","BODEGA AURRERA CANTIL","MEGA COMERCIAL MEXICANA SAN MATEO","COSTCO LA ESTANCIA","COMERCIAL MEXICANA PABELLON BOSQUES","CHEDRAUI TABASCO II","CHEDRAUI XALAPA MUSEO","WAL MART LAS ANIMAS","CHEDRAUI AJUSCO","CHEDRAUI TIERRA COLORADA","WAL MART AVILA CAMACHO","CLIENTE 2274 TUXTLA GUTIERREZ AV","WAL MART ZACATECAS","WAL MART VILLAHERMOSA I","WAL MART MERIDA NORTE","CHEDRAUI XALAPA CRYSTAL","MEGA COMERCIAL MEXICANA PUEBLA","BODEGA AURRERA COACALCO","HEB CONTRY","CHEDRAUI CIUDAD DEL CARMEN","CHEDRAUI MOLINA","CHEDRAUI MERIDA","BODEGA AURRERA LOS ANGELES IZTAPALAPA","WAL MART METEPEC","SAMS CLUB QUERETARO","WAL MART SAN MARCOS IZCALLI","CHEDRAUI COATZACOALCOS I","WAL MART EL PITILLAL","WAL MART NIÑO OBRERO","OXXO ALEMANIA","WAL MART TORRES LANDA","WAL MART TEPIC","CHEDRAUI TABASCO I","SUPERCENTER LOMAS VERDES","WAL MART ACAPULCO","WAL MART JIUTEPEC","WAL MART LAS ALAMEDAS","COSTCO PUEBLA","WAL MART LAS AGUILAS","CHEDRAUI POZA RICA I"],[154662268.05,7697623.42,4814696.32,4018866.67,3325556.87,2931618.23,2819876.17,2650769.28,2599058.71,2148013.48,2043999.33,2025533.41,1908225.03,1844810.26,1836277.99,1832286.28,1815475.88,1812608,1805601.33,1791937.21,1746951.63,1728546.77,1676163.47,1581963.96,1572347.66,1540402.16,1530147.3,1525396.34,1524666.67,1518984.33,1512651.76,1512088.86,1502289.41,1496589.8,1487031.18,1486264.67,1484865.32,1482867.05,1478206.27,1473749.1,1461561.44,1429014.56,1423566.96,1419142.95,1415020.46,1399116.87,1398395.44,1392886.78,1367300.23,1366446.96,1346045.89,1338079.37,1318864.33,1310566.59,1300853.41,1284506.98,1280872.53,1266657.38,1262314.83,1257973.31,1232692.95,1232386.17,1209835.92,1205535.53,1205442.17,1203216.69,1201892.38,1197234.16,1196996.55,1196392.57,1190137.19,1189251.62,1187123.55,1182868.06,1181065.87,1176870.72,1139686.53,1137045.87,1135387.81,1135248.85,1132349.43,1127416.07,1125885.06,1113131.54,1102938.78,1100502.03,1100097.7,1096785.76,1092398.2,1087659.4,1084701.16,1083744.58,1075382.83,1073212.02,1062697.12,1062280.23,1056201.01,1052117.09,1051258.35,1048022.46]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Cliente_ID<\/th>\n      <th>NombreCliente<\/th>\n      <th>Valor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\");\n  }"},{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
<div id="top-100-produtos-1" class="section level2">
<h2><span class="header-section-number">7.10</span> Top 100 Produtos</h2>
<pre class="r"><code>datatable(produto_t100[, c(&quot;Producto_ID&quot;, &quot;NombreProducto&quot;, &quot;Valor&quot;)] %&gt;%
            arrange(desc(Valor)), class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
)) %&gt;% formatRound(columns = c(&quot;Valor&quot;), digits = 2)</code></pre>
<div id="htmlwidget-438795aa313b8f63ab78" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-438795aa313b8f63ab78">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100"],["2233","1146","2425","1240","1250","1150","1278","1125","43285","1242","1232","1182","34786","35651","1109","30532","1284","37058","43069","1129","34865","1160","30572","41938","34206","46772","34210","35145","1238","3631","43058","43307","1309","35305","34211","1120","1212","48996","43206","972","49028","1145","1216","34053","1230","6469","34785","2665","30575","34802","1220","1064","34213","1169","4280","43200","43203","48417","34204","31310","30314","41843","5380","4767","35571","31507","34264","3144","2025","43350","43202","35144","43246","35142","34212","40447","73","37057","31423","3270","35309","641","46876","5200","43064","5000","30571","43118","43207","47336","30531","43060","3894","40450","1144","34207","43316","37005","34867","4910"],["Pan Blanco 640g BIM 2233","Pan Integral 675g BIM 1146","Nito 1p 62g Central BIM 2425","Mantecadas Vainilla 4p 125g BIM 1240","Donas Azucar 4p 105g BIM 1250","Medias Noches 8p 340g BIM 1150","Nito 1p 62g BIM 1278","Tortillinas 10p 255g TR 1125","Gansito 1p 50g MTB MLA 43285","Donitas Espolvoreadas 6p 105g BIM 1242","Panque Nuez 255g BIM 1232","Tostado 210g CU BIM 1182","Pan Integral 680g TNB BIM 34786","Madalenas 3p 93g BIM 35651","Pan Blanco Chico 360g BIM 1109","Principe 10p 106g Prom MTB MLA 30532","Rebanada 2p 55g BIM 1284","Choco Roles 2p 80g MTA MLA 37058","Pinguinos 2p 80g MTA MLA 43069","Tortillinas 20p 510g TR 1129","Pan Blanco 680g TNB BIM 34865","Bimbollos 8p 450g BIM 1160","Barritas Fresa 67g Prom MTB MLA 30572","Mantecadas Nuez 123g BIM 41938","Medias Noches 8p 340g TNB BIM 34206","Pan Molido 210g BIM 46772","Super Pan Blanco 740g TNB BIM 34210","Wonder 100pct con Ajonjoli 567g MTA WON 35145","Panquecito Gota Choc 2p 140g BIM 1238","Pan Integral 370g BIM 3631","Sponch 8p 120g MTB MLA 43058","Gansito 1p 50g CCharola MTA MLA 43307","Bimbunuelos 4p 66g BIM 1309","Barritas Fresa 75g Prom MTB MLA 35305","Pan Blanco 460g TNB BIM 34211","Pan Blanco 680g BIM 1120","Roles Canela 2p 120g BIM 1212","Tortillinas 22p 570g MTA TR 48996","Nito 1p 62g MTB BIM 43206","Roles Canela 6p 365g BIM 972","Tortillinas 12p 310g MTA TR 49028","Pan Integral 680g BIM 1145","Roles Glass 2p 135g BIM 1216","Nito 1p 62g SP BIM 34053","Panque Pasas 255g BIM 1230","Totopos 280g DH 6469","Pan Integral 480g TNB BIM 34785","Tostada Ondulada Tubo 30p 360g Cj MR 2665","Barritas Pina 67g Prom MTB MLA 30575","Pan Multigrano Linaza 540g TNB BIM 34802","Colchones 6p 130g BIM 1220","Panque Marmol 255g BIM 1064","Pan Blanco 640g TNB BIM 34213","Bimbollos Extra 6p 480g BIM 1169","Doraditas 110g TR 4280","Panque Nuez 255g MTA BIM 43200","Donitas Espolvoreadas 6p 105g MTB BIM 43203","Bran Frut Fresa 48g BIM 48417","Bimbollos 8p 450g TNB BIM 34204","Canelitas 90g MTB MLA 31310","Canelitas KC 360g MLA 30314","Leche Nito 236ml BIM 41843","Pinguinos 2p 80g MLA 5380","Tostado Doble Fibra 250g Cj BIM 4767","Pan Integral 675g TNB BIM 35571","Polvoron 6p 113g MTB MLA 31507","Bimbollos Extra 6p 480g TNB BIM 34264","Pan Multigrano 540g BIM 3144","Pan Blanco 460g BIM 2025","Bollos Extra Ajn 12p 960g MTA BIM 43350","Mantecadas Vainilla 4p 125g MTA BIM 43202","Wonder 100pct con Ajonjoli 567g WON 35144","Pan Multigrano 540g MTA BIM 43246","Super Pan Blanco Ajonjoli 567g MTA WON 35142","Pan Doble Fibra 640g TNB BIM 34212","Tortillinas 12p 310g TR 40447","Pan Multigrano Linaza 540g BIM 73","Choco Roles 2p 80g MLA 37057","Donas Azucar Tubo 10p 158g BIM 31423","Conchas Vainilla 2p 120g BIM 3270","Barritas Pina 75g Prom MTB MLA 35309","Bollo Extra Grande 15p 1200g BIM 641","Pan Molido 210g MTA BIM 46876","Coca Cola Lata 355ml CC 5200","Submarinos Fresa 3p 105g SP MTA MLA 43064","Gansito 1p 50g CCharola MLA 5000","Barritas Fresa 67g MLA 30571","Mantecadas Nuez 123g MTA BIM 43118","Rebanada 2p 55g MTA BIM 43207","Medias Noches FS 8p 340g BIM 47336","Principe 10p 106g Prom MLA 30531","Bimbolunch 6p 354g ME MTA BIM 43060","Sponch 8p 120g MLA 3894","Tortillinas 22p 570g TR 40450","Pan Integral 480g BIM 1144","Medias Noches 10p 430g TNB BIM 34207","Submarinos Vainilla 3p 105g SP MTA MLA 43316","Madalenas 3p 93g SP BIM 37005","Pan Blanco 2pq 1360g TNB BIM 34867","Empanizador Crujiente 175g BIM 4910"],[222987226.340001,139406610.549999,107365672.8,104695280.86,94121216.1999993,91864563.2499995,88448179.5,80681277.34,80239868.6400001,80161583.4099994,79990555.4800002,67938108.61,67283408.06,66887007.79,66879606.3199998,61485343.3200001,59297774.8300001,56917503.74,53464917.8199997,53342391.98,51135920.08,47763390.2600001,45803397.18,44703414.1899997,44124758.38,43557603.83,43075554.09,42098973.13,38339703.11,36548233.4700001,34816523.28,33077405.81,32617761.8900002,30979202.17,30664548.01,29786117.43,29280448.1899999,29279029.02,29137946.24,27526792.7599999,27189788.58,26999856.21,26691390.74,25033264.38,24620429.7300001,24326112.53,24308869.02,23717686.21,23614273,23468481.25,21657227.66,21211615.7100001,21014932.15,20329907.28,19419817.05,18690373.74,18642433.74,18472605.84,18253294.66,17760851.99,17661955.94,17324853.29,17301417.31,17198075.58,17111169.28,16776047.55,16692679.23,16608324.09,16602822.82,16407561.31,16323305.46,16300376.77,16292496.82,15732229.43,15660384.96,15630708.62,15347261.91,15327889.6,15247703.29,15177680.89,14304252.83,14143442.2,13978353.96,13701177.46,13689624.15,13455332.18,13194794.34,12905090.33,12797868.9,12587504.1,12524160.06,12259292.83,12158953.98,12158071.84,11754729.5,11481718.96,11366047.25,11113343.08,10946322.79,10935188.93]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Producto_ID<\/th>\n      <th>NombreProducto<\/th>\n      <th>Valor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"targets":3,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\");\n  }"},{"className":"dt-right","targets":3},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
<div id="marcas-1" class="section level2">
<h2><span class="header-section-number">7.11</span> Marcas</h2>
<pre class="r"><code>datatable(marcas[, c(&quot;Marca&quot;, &quot;Valor&quot;)] %&gt;%
            arrange(desc(Valor)), class=&quot;table-condensed&quot;,
          options = list(pageLength = 10,
                         lengthMenu = c(10, 20, 50, 100)
)) %&gt;% formatRound(columns = c(&quot;Valor&quot;), digits = 2)</code></pre>
<div id="htmlwidget-7ea87c80a3d0bf6bd1f0" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-7ea87c80a3d0bf6bd1f0">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],["BIM","MLA","TR","WON","DH","LAR","MR","ORO","BAR","SL","CC","LON","SAN","SUN","JMX","SUA","RIC","GBI","KOD","MP","THO","PUL","TRI","COR","BRE","SKD","MSK","AM","NES","VER"],[3039141953.51992,967546172.260015,442556922.330001,144846529.61,95317314.33,66275529.4499999,64881575.3199999,49832650.85,40251982.8,37648326.52,27307050.09,25192736.95,24906602.34,18555613.98,13253473.76,11368890.42,7217103.14,4956829.29,1240695.03,986465.9,631113.01,386035.26,180629.01,127330.68,42792.4,11856.84,310,5,0,0]],"container":"<table class=\"table-condensed\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Marca<\/th>\n      <th>Valor<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":10,"lengthMenu":[10,20,50,100],"columnDefs":[{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\");\n  }"},{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.columnDefs.0.render"],"jsHooks":[]}</script>
</div>
</div>
<div id="análise-exploratória" class="section level1">
<h1><span class="header-section-number">8</span> Análise exploratória</h1>
<div id="verificar-a-estrutura-e-resumo-estatístico" class="section level2">
<h2><span class="header-section-number">8.1</span> Verificar a estrutura e resumo estatístico</h2>
<ul>
<li>Verificar dados missing.</li>
<li>Verificar dados únicos</li>
<li>Verificar a estrutura.</li>
<li>Verificar resumo estatístico.</li>
<li>Exibir amostra dos dados.</li>
</ul>
<pre class="r"><code># Verifica o conteúdo do dataset
# Verifica dados missing
colSums(is.na(treino))</code></pre>
<pre><code>##            Semana        Agencia_ID          Canal_ID          Ruta_SAK 
##                 0                 0                 0                 0 
##        Cliente_ID       Producto_ID     Venta_uni_hoy         Venta_hoy 
##                 0                 0                 0                 0 
##   Dev_uni_proxima       Dev_proxima Demanda_uni_equil 
##                 0                 0                 0</code></pre>
<pre class="r"><code># Verifica dados únicos
sapply(treino, function(x) length(unique(x)))</code></pre>
<pre><code>##            Semana        Agencia_ID          Canal_ID          Ruta_SAK 
##                 7               552                 9              3603 
##        Cliente_ID       Producto_ID     Venta_uni_hoy         Venta_hoy 
##            880604              1799              2116             78140 
##   Dev_uni_proxima       Dev_proxima Demanda_uni_equil 
##               558             14707              2091</code></pre>
<pre class="r"><code># Verifica a estrutura e o resumo dos dados
str(treino)</code></pre>
<pre><code>## Classes &#39;data.table&#39; and &#39;data.frame&#39;:   74180464 obs. of  11 variables:
##  $ Semana           : num  3 3 3 3 3 3 3 3 3 3 ...
##  $ Agencia_ID       : chr  &quot;1110&quot; &quot;1110&quot; &quot;1110&quot; &quot;1110&quot; ...
##  $ Canal_ID         : chr  &quot;7&quot; &quot;7&quot; &quot;7&quot; &quot;7&quot; ...
##  $ Ruta_SAK         : chr  &quot;3301&quot; &quot;3301&quot; &quot;3301&quot; &quot;3301&quot; ...
##  $ Cliente_ID       : chr  &quot;15766&quot; &quot;15766&quot; &quot;15766&quot; &quot;15766&quot; ...
##  $ Producto_ID      : chr  &quot;1212&quot; &quot;1216&quot; &quot;1238&quot; &quot;1240&quot; ...
##  $ Venta_uni_hoy    : num  3 4 4 4 3 5 3 6 4 6 ...
##  $ Venta_hoy        : num  25.1 33.5 39.3 33.5 22.9 ...
##  $ Dev_uni_proxima  : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ Dev_proxima      : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ Demanda_uni_equil: num  3 4 4 4 3 5 3 6 4 6 ...
##  - attr(*, &quot;.internal.selfref&quot;)=&lt;externalptr&gt;</code></pre>
<pre class="r"><code>summary(treino)</code></pre>
<pre><code>##      Semana      Agencia_ID          Canal_ID           Ruta_SAK        
##  Min.   :3.00   Length:74180464    Length:74180464    Length:74180464   
##  1st Qu.:4.00   Class :character   Class :character   Class :character  
##  Median :6.00   Mode  :character   Mode  :character   Mode  :character  
##  Mean   :5.95                                                           
##  3rd Qu.:8.00                                                           
##  Max.   :9.00                                                           
##   Cliente_ID        Producto_ID        Venta_uni_hoy       Venta_hoy       
##  Length:74180464    Length:74180464    Min.   :   0.00   Min.   :     0.0  
##  Class :character   Class :character   1st Qu.:   2.00   1st Qu.:    16.8  
##  Mode  :character   Mode  :character   Median :   3.00   Median :    30.0  
##                                        Mean   :   7.31   Mean   :    68.5  
##                                        3rd Qu.:   7.00   3rd Qu.:    56.1  
##                                        Max.   :7200.00   Max.   :647360.0  
##  Dev_uni_proxima    Dev_proxima        Demanda_uni_equil 
##  Min.   :0.0e+00   Min.   :     0.00   Min.   :   0.000  
##  1st Qu.:0.0e+00   1st Qu.:     0.00   1st Qu.:   2.000  
##  Median :0.0e+00   Median :     0.00   Median :   3.000  
##  Mean   :1.3e-01   Mean   :     1.24   Mean   :   7.225  
##  3rd Qu.:0.0e+00   3rd Qu.:     0.00   3rd Qu.:   6.000  
##  Max.   :2.5e+05   Max.   :130760.00   Max.   :5000.000</code></pre>
</div>
<div id="variável-alvo-demanda_uni_equil" class="section level2">
<h2><span class="header-section-number">8.2</span> Variável alvo (Demanda_uni_equil)</h2>
<p>Demanda_uni_equil tem muitos outliers. Podemos constatar pela discrepância entre os valores do terceiro quartil (6) e máximo (5000), além da média (7.225) ser superior ao terceiro quartil. Utilizaremos boxplots para verificar o ponto de corte ideal para gerar histogramas. Serão dois histogramas, um com os dados sem outliers e outro com parte da cauda.</p>
<pre class="r"><code># Verifica a distribuição dos dados
treino_sample %&gt;% 
    count(Demanda_uni_equil) %&gt;% 
    ggplot(aes(x = &quot;&quot;, y = Demanda_uni_equil)) +
    geom_boxplot(fill = &quot;steelblue4&quot;, outlier.colour=&quot;red&quot;) +
    ggtitle(&quot;Demanda&quot;) +
    xlab(&quot;&quot;)+ ylab(&quot;Demanda&quot;) + theme_bw()</code></pre>
<p><img src="Projeto02_files/figure-html/demanda-1.png" width="672" /></p>
<pre class="r"><code># Verifica a distribuição minimizando os outliers
treino_sample %&gt;% 
    count(Demanda_uni_equil) %&gt;% 
    filter(Demanda_uni_equil &lt; 12) %&gt;% 
    ggplot(aes(x = &quot;&quot;, y = Demanda_uni_equil)) +
    geom_boxplot(fill = &quot;steelblue4&quot;, outlier.colour=&quot;red&quot;) +
    ggtitle(&quot;Demanda sem outliers&quot;) +
    xlab(&quot;&quot;)+ ylab(&quot;Demanda&quot;) + theme_bw()</code></pre>
<p><img src="Projeto02_files/figure-html/demanda-2.png" width="672" /></p>
<pre class="r"><code># Histograma sem outliers
treino_sample %&gt;% 
    count(Demanda_uni_equil) %&gt;% 
    filter(Demanda_uni_equil &lt; 12) %&gt;% 
    ggplot(aes(x = Demanda_uni_equil, y = n)) +
        geom_bar(stat = &quot;identity&quot;, fill = &quot;steelblue4&quot;) +
        ggtitle(&quot;Distribuição da Demanda&quot;) +
        theme_bw()</code></pre>
<p><img src="Projeto02_files/figure-html/demanda-3.png" width="672" /></p>
<pre class="r"><code># Histograma parcial da cauda
treino_sample %&gt;% 
    count(Demanda_uni_equil) %&gt;% 
    filter(Demanda_uni_equil &gt;= 12 &amp; Demanda_uni_equil &lt; 100) %&gt;% 
    ggplot(aes(x = Demanda_uni_equil, y = n)) +
        geom_bar(stat = &quot;identity&quot;, fill = &quot;steelblue4&quot;) +
        ggtitle(&quot;Distribuição da Demanda - cauda&quot;) +
        theme_bw()</code></pre>
<p><img src="Projeto02_files/figure-html/demanda-4.png" width="672" /></p>
<p>Há indicação de venda em lotes, por exemplo: 12, 15, 20, 30, 40, 60 e 80.</p>
</div>
<div id="semanas" class="section level2">
<h2><span class="header-section-number">8.3</span> Semanas</h2>
<pre class="r"><code># Distribuição por Semana
treino_sample %&gt;% 
    count(Semana) %&gt;% 
    ggplot(aes(x = Semana, y = n)) +
        geom_bar(stat = &quot;identity&quot;, fill = &quot;steelblue4&quot;) +
        ggtitle(&quot;Distribuição por Semana&quot;) +
        theme_bw()</code></pre>
<p><img src="Projeto02_files/figure-html/semana-1.png" width="672" /></p>
<p>Não há variação significativa entre as semanas.</p>
</div>
<div id="treemaps" class="section level2">
<h2><span class="header-section-number">8.4</span> Treemaps</h2>
<p>Criaremos treemaps com variáveis preditoras considerando o volume de vendas em valores. A taxa de devolução será indicada pela tonalidade da cor. Quanto mais escura, pior a taxa.</p>
<div id="top-100-centros-de-distribuição-2" class="section level3">
<h3><span class="header-section-number">8.4.1</span> Top 100 Centros de Distribuição</h3>
<pre class="r"><code># Treemap dos top 100 centros
treemap(agencia_t100,index=c(&quot;Town&quot;), vSize=&quot;Valor&quot;, vColor=&quot;TaxaDevolv&quot;, 
        palette=c(&quot;white&quot;,&quot;white&quot;,&quot;steelblue4&quot;), type=&quot;value&quot;,
        title.legend=&quot;Unidades devolvidas %&quot;,
        title=&quot;Top 100 Centros de Distribuição&quot;)</code></pre>
<p><img src="Projeto02_files/figure-html/agencia-1.png" width="672" /></p>
</div>
<div id="canais-de-vendas-2" class="section level3">
<h3><span class="header-section-number">8.4.2</span> Canais de Vendas</h3>
<pre class="r"><code># Treemap dos canais
treemap(canal, 
        index=c(&quot;Canal_ID&quot;), vSize=&quot;Valor&quot;, vColor=&quot;TaxaDevolv&quot;, 
        palette=c(&quot;white&quot;,&quot;white&quot;,&quot;steelblue4&quot;), type=&quot;value&quot;,
        title.legend=&quot;Unidades devolvidas %&quot;,
        title=&quot;Distribuição por canal&quot;)</code></pre>
<p><img src="Projeto02_files/figure-html/canal-1.png" width="672" /></p>
</div>
<div id="top-100-rotas-2" class="section level3">
<h3><span class="header-section-number">8.4.3</span> Top 100 Rotas</h3>
<pre class="r"><code># Treemap das rotas
treemap(rota_t100, 
        index=c(&quot;Ruta_SAK&quot;), vSize=&quot;Valor&quot;, vColor=&quot;TaxaDevolv&quot;, 
        palette=c(&quot;white&quot;,&quot;white&quot;,&quot;steelblue4&quot;), type=&quot;value&quot;,
        title.legend=&quot;Unidades devolvidas %&quot;,
        title=&quot;Distribuição por rota&quot;)</code></pre>
<p><img src="Projeto02_files/figure-html/rota-1.png" width="672" /></p>
</div>
<div id="top-100-clientes-2" class="section level3">
<h3><span class="header-section-number">8.4.4</span> Top 100 Clientes</h3>
<pre class="r"><code># Treemap dos top 100 clientes
treemap(cliente_t100, index=c(&quot;NombreCliente&quot;), vSize=&quot;Valor&quot;, vColor=&quot;TaxaDevolv&quot;, 
        palette=c(&quot;white&quot;,&quot;white&quot;,&quot;steelblue4&quot;), type=&quot;value&quot;,
        title.legend=&quot;Unidades devolvidas %&quot;,
        title=&quot;Top 100 Clientes&quot;)</code></pre>
<p><img src="Projeto02_files/figure-html/cliente-1.png" width="672" /></p>
</div>
<div id="top-100-produtos-2" class="section level3">
<h3><span class="header-section-number">8.4.5</span> Top 100 Produtos</h3>
<pre class="r"><code># Treemap dos top 100 produtos
treemap(produto_t100, index=c(&quot;NombreProducto&quot;), vSize=&quot;Valor&quot;, vColor=&quot;TaxaDevolv&quot;, 
        palette=c(&quot;white&quot;,&quot;white&quot;,&quot;steelblue4&quot;), type=&quot;value&quot;,
        title.legend=&quot;Unidades devolvidas %&quot;,
        title=&quot;Top 100 Produtos&quot;)</code></pre>
<p><img src="Projeto02_files/figure-html/produto-1.png" width="672" /></p>
</div>
<div id="top-10-marcas" class="section level3">
<h3><span class="header-section-number">8.4.6</span> Top 10 Marcas</h3>
<pre class="r"><code># Treemap das top 10 marcas
treemap(marcas[1:10,], index=c(&quot;Marca&quot;), vSize=&quot;Valor&quot;, vColor=&quot;TaxaDevolv&quot;, 
        palette=c(&quot;white&quot;,&quot;white&quot;,&quot;steelblue4&quot;), type=&quot;value&quot;,
        title.legend=&quot;Unidades devolvidas %&quot;,
        title=&quot;Top 10 Marcas&quot;)</code></pre>
<p><img src="Projeto02_files/figure-html/marca-1.png" width="672" /></p>
</div>
<div id="notas-1" class="section level3">
<h3><span class="header-section-number">8.4.7</span> Notas</h3>
<p>A taxa de unidades devolvidas aparenta estar mais relacionada a Rotas(0.14%) e Clientes(0.10%) que Produtos (0.04%), Canais (0.06%) e Centros(0.07%).</p>
<p>Os canais 5 e 8 têm taxas discrepantes em relação aos demais.</p>
<p>A rota 3001 se mostra a maior responsável por Rotas terem a maior taxa de devolução.</p>
<p>O cliente Puebla Remision é responsável por quase a metade das vendas e a taxa de devolução não é baixa. Jalisco Remision é o quarto em volume de vendas e tem taxa de devolução elevada.</p>
<p>Três entre os quatro maiores clientes tem a palavra Remision precedida do nome de uma cidade no México. Uma das traduções desta palavra é encaminhamento, então, esses três grandes clientes podem ser entrepostos comerciais e não lojas varejistas finais.</p>
</div>
</div>
</div>
<div id="engenharia-de-atributos" class="section level1">
<h1><span class="header-section-number">9</span> Engenharia de atributos</h1>
<div id="remoção-de-variáveis-e-dataframes" class="section level2">
<h2><span class="header-section-number">9.1</span> Remoção de variáveis e dataframes</h2>
<p>As variáveis <strong>Venta_uni_hoy</strong>, <strong>Venta_hoy</strong>, <strong>Dev_uni_proxima</strong> e <strong>Dev_proxima</strong> não existem no dataset de teste, então não serão úteis para machine learning.</p>
<p>Elas foram carregadas inicialmente por suas importâncias na análise exploratória. A geração dos treemaps, por exemplo, com base em volume de vendas em valores e taxa de devolução, foram construídos por sumarizações obtidas a partir destas variáveis.</p>
<p>Apenas os dataframes de treino e teste serão preservados, os demais serão removidos para poupar memória.</p>
<pre class="r"><code># Remoção de variáveis
treino[,c(&quot;Venta_uni_hoy&quot;,&quot;Venta_hoy&quot;,&quot;Dev_uni_proxima&quot;,&quot;Dev_proxima&quot;)] &lt;- NULL

# Remoção de datasets
rm(agencia_t100,canal,cliente_t100,clientes,produto_t100,produtos,rota_t100,
   town_state,treino_sample,marcas)

# Limpa a memória (garbage collection)
gc()</code></pre>
<pre><code>##             used   (Mb) gc trigger    (Mb)   max used    (Mb)
## Ncells   8136603  434.6   25687318  1371.9   25687318  1371.9
## Vcells 670397611 5114.8 1858865391 14182.1 2314453374 17657.9</code></pre>
</div>
<div id="variáveis-categóricas-em-inteiros" class="section level2">
<h2><span class="header-section-number">9.2</span> Variáveis categóricas em inteiros</h2>
<p>A geração de gráficos na fase de análise exploratória foi facilitada por termos carregados as variáveis <strong>Agencia_ID</strong>, <strong>Canal_ID</strong>, <strong>Ruta_SAK</strong>, <strong>Cliente_ID</strong> e <strong>Producto_ID</strong> como texto, porém mais adiante serão transformadas pela função <strong>log1p</strong>. Primeiramente serão transformadas para inteiros.</p>
<pre class="r"><code># Trasforma variáveis de treino
treino[,c(2,3,4,5,6)] &lt;-  lapply(treino[,c(2,3,4,5,6)], as.integer)
# Trasforma variáveis de teste
teste[,c(1,3,4,5,6,7)] &lt;-  lapply(teste[,c(1,3,4,5,6,7)], as.integer)</code></pre>
</div>
<div id="transformação-da-variável-alvo" class="section level2">
<h2><span class="header-section-number">9.3</span> Transformação da variável alvo</h2>
<p>A métrica de avaliação dessa competição é Raiz Quadrado do Erro Logarítmico Médio Quadrático, então a transformação de <strong>Demanda_uni_equil</strong> será feita com a função <strong>log1p</strong>, que computa o logaritmo do número acrescido de uma unidade.</p>
<p>Por existirem valores zero em <strong>Demanda_uni_equil</strong> a função <strong>log</strong> não poderá ser utilizada porque o limite de <span class="math inline">\(\log(x)\)</span> quando <span class="math inline">\(x\)</span> se aproxima de <span class="math inline">\(0+\)</span> é <span class="math inline">\(-\infty\)</span>).</p>
<p><span class="math display">\[lim_{x \to 0+}ln(x) = -\infty\]</span></p>
<pre class="r"><code># Transformação da variável alvo com logaritmo do seu valor acrescido de uma
# unidade.
treino$Demanda_uni_equil &lt;- log1p(treino$Demanda_uni_equil)

# Cria variável id no dataset de treino, Demanda_uni_equil no dataset de test
# para que ambos tenham as mesmas variáveis. Também cria a variável tst para
# identificar se os dados são de treino ou de teste.
treino$id &lt;- 0; teste$Demanda_uni_equil &lt;- 0; treino$tst &lt;- 0; teste$tst &lt;- 1

# Agrega os dados de treino da nona semana com os dados de teste em um dataset
# que receberá os dados transformados
trans_treino &lt;- rbind(treino[Semana == 9], teste)</code></pre>
</div>
<div id="médias-e-contagens-por-variáveis-e-grupos-de-variáveis" class="section level2">
<h2><span class="header-section-number">9.4</span> Médias e contagens por variáveis e grupos de variáveis</h2>
<p>Criaremos variáveis com médias da variável alvo considerando as variáveis categóricas tanto isoladas quando em grupos. Criaremos também variáveis contendo contagens sob as mesmas regras das médias.</p>
<pre class="r"><code># Calcula a demanda média e a contagem das semanas de 3 a 8 e em seguida junta
# com as semanas 9, 10 e 11.

# Média e contagem por produto e cliente
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPC = mean(Demanda_uni_equil), CPC = .N),
                      by = .(Producto_ID, Cliente_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;, &quot;Cliente_ID&quot;))
# Média e contagem por produto
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MP = mean(Demanda_uni_equil), CP = .N),
                      by = .(Producto_ID)] %&gt;% 
    merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;))

# Média e contagem por cliente
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MC = mean(Demanda_uni_equil), CC = .N),
                      by = .(Cliente_ID)] %&gt;% 
    merge(trans_treino, all.y = TRUE, by = c(&quot;Cliente_ID&quot;))

# Média e contagem por produto e rota
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPR = mean(Demanda_uni_equil), CPR = .N),
                   by = .(Producto_ID, Ruta_SAK)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;, &quot;Ruta_SAK&quot;))

# Média e contagem por cliente e rota
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MCR = mean(Demanda_uni_equil), CCR = .N),
                   by = .(Cliente_ID, Ruta_SAK)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Cliente_ID&quot;, &quot;Ruta_SAK&quot;))

# Média e contagem por produto e agencia
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPA = mean(Demanda_uni_equil), CPA = .N),
                   by = .(Producto_ID, Agencia_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;, &quot;Agencia_ID&quot;))

# Média e contagem por produto, cliente  e agencia
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPCA = mean(Demanda_uni_equil), CPCA = .N),
                   by = .(Producto_ID, Cliente_ID, Agencia_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, 
        by = c(&quot;Producto_ID&quot;, &quot;Cliente_ID&quot;, &quot;Agencia_ID&quot;))</code></pre>
</div>
<div id="remove-semana-e-preenche-valores-ausentes" class="section level2">
<h2><span class="header-section-number">9.5</span> Remove <strong>Semana</strong> e preenche valores ausentes</h2>
<pre class="r"><code># Remove Semana
trans_treino$Semana &lt;- NULL

# Preenche valores ausentes com zero
trans_treino[is.na(trans_treino)] &lt;- 0

# Remoção de datasets
rm(treino,teste)

# Limpa a memória
gc()</code></pre>
<pre><code>##             used   (Mb) gc trigger    (Mb)   max used    (Mb)
## Ncells   1122258   60.0    6733778   359.7   25687318  1371.9
## Vcells 434588665 3315.7 1784574776 13615.3 2314453374 17657.9</code></pre>
</div>
<div id="aplica-log1p-a-todas-variáveis-categóricas-e-de-contagens" class="section level2">
<h2><span class="header-section-number">9.6</span> Aplica <strong>log1p</strong> a todas variáveis categóricas e de contagens</h2>
<pre class="r"><code># Aplica log1p
trans_treino[,c(1,2,3,7,8,10,12,14,16,18)] &lt;-
  lapply(trans_treino[,c(1,2,3,7,8,10,12,14,16,18)], log1p)</code></pre>
</div>
</div>
<div id="modelos" class="section level1">
<h1><span class="header-section-number">10</span> Modelos</h1>
<p>Utilizaremos quatro modelos ML da plataforma H2O.ai.</p>
<div id="iniciar-o-cluster-e-preparar-os-datasets" class="section level2">
<h2><span class="header-section-number">10.1</span> Iniciar o cluster e preparar os datasets</h2>
<pre class="r"><code>library(h2o)

# Inicia o cluster H2O
h2o.init(nthreads=-1, max_mem_size=&quot;40G&quot;,ip = &quot;127.0.0.1&quot;)</code></pre>
<pre><code>## 
## H2O is not running yet, starting it now...
## 
## Note:  In case of errors look at the following log files:
##     /tmp/RtmpFs9tcK/file29c539d55017/h2o_carloslessa_started_from_r.out
##     /tmp/RtmpFs9tcK/file29c51751931f/h2o_carloslessa_started_from_r.err
## 
## 
## Starting H2O JVM and connecting: .. Connection successful!
## 
## R is connected to the H2O cluster: 
##     H2O cluster uptime:         1 seconds 148 milliseconds 
##     H2O cluster timezone:       America/Maceio 
##     H2O data parsing timezone:  UTC 
##     H2O cluster version:        3.32.0.3 
##     H2O cluster version age:    1 month and 5 days  
##     H2O cluster name:           H2O_started_from_R_carloslessa_oey273 
##     H2O cluster total nodes:    1 
##     H2O cluster total memory:   40.00 GB 
##     H2O cluster total cores:    4 
##     H2O cluster allowed cores:  4 
##     H2O cluster healthy:        TRUE 
##     H2O Connection ip:          127.0.0.1 
##     H2O Connection port:        54321 
##     H2O Connection proxy:       NA 
##     H2O Internal Security:      FALSE 
##     H2O API Extensions:         Amazon S3, XGBoost, Algos, AutoML, Core V3, TargetEncoder, Core V4 
##     R Version:                  R version 3.6.3 (2020-02-29)</code></pre>
<pre class="r"><code># Limpa o ambiente - apenas no caso do cluster já estar em execução
h2o.removeAll()

# Não exibir a barra de progresso na saída RMarkdown
h2o.no_progress()

# Treino em dataframe H2O
system.time(h2o_treino &lt;- as.h2o(as.data.frame(trans_treino[tst == 0]) %&gt;%
                       select(-id, -tst)))</code></pre>
<pre><code>##    user  system elapsed 
## 143.943   2.922 159.440</code></pre>
<pre class="r"><code># Teste em dataframe H2O
system.time(h2o_teste &lt;- as.h2o(as.data.frame(trans_treino[tst == 1]) %&gt;%
                      select(-Demanda_uni_equil, -id, -tst)))</code></pre>
<pre><code>##    user  system elapsed 
##  91.261   1.747 100.307</code></pre>
<pre class="r"><code># Identifica a variável alvo e as preditoras
response &lt;- &quot;Demanda_uni_equil&quot;
predictors &lt;- setdiff(names(h2o_treino), response)

# Extrai o id 
id &lt;- as.integer(trans_treino[tst == 1]$id)

# Remove trans_treino
rm(trans_treino)
# Limpa a memória
gc()</code></pre>
<pre><code>##            used  (Mb) gc trigger   (Mb)   max used    (Mb)
## Ncells  1323195  70.7    4309619  230.2   25687318  1371.9
## Vcells 98966315 755.1 1142127857 8713.8 2314453374 17657.9</code></pre>
</div>
<div id="random-forest" class="section level2">
<h2><span class="header-section-number">10.2</span> Random Forest</h2>
<p>Distributed Random Forest (DRF) é uma ferramenta poderosa de classificação e regressão. Quando fornecido um conjunto de dados, o DRF gera uma floresta de árvores, em vez de uma única árvore de classificação ou regressão.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<pre class="r"><code>system.time(model_rf &lt;-
              h2o.randomForest(x = predictors,
                               y = response,
                               training_frame = h2o_treino,
                               nfolds = 5,
                               fold_assignment = &quot;Modulo&quot;,
                               ntrees = 50,
                               max_depth = 8,
                               min_rows = 1,
                               sample_rate = 0.7,
                               keep_cross_validation_predictions = T,
                               seed = 1))</code></pre>
<pre><code>##    user  system elapsed 
##   2.932   0.122 832.728</code></pre>
</div>
<div id="generalized-linear-model" class="section level2">
<h2><span class="header-section-number">10.3</span> Generalized Linear Model</h2>
<p>É uma generalização flexível da regressão linear ordinária. GLM estimam modelos de regressão para resultados seguindo distribuições exponenciais. Além da distribuição gaussiana (ou seja, normal), isso inclui as distribuições de Poisson, binomial e gama.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<pre class="r"><code>system.time(model_glm &lt;-
              h2o.glm(x = predictors,
                      y = response,
                      training_frame = h2o_treino,
                      nfolds = 5,
                      fold_assignment = &quot;Modulo&quot;,
                      keep_cross_validation_predictions = T,
                      seed = 1))</code></pre>
<pre><code>##    user  system elapsed 
##   0.251   0.007  19.353</code></pre>
</div>
<div id="gradient-boosted" class="section level2">
<h2><span class="header-section-number">10.4</span> Gradient Boosted</h2>
<p>Gradient Boosting Machine é um método de conjunto de aprendizagem progressiva. A heurística orientadora é que bons resultados preditivos podem ser obtidos por meio de aproximações cada vez mais refinadas.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<pre class="r"><code>system.time(model_gbm &lt;-
              h2o.gbm(x = predictors,
                      y = response,
                      training_frame = h2o_treino,
                      distribution = &quot;gaussian&quot;,
                      ntrees = 50,
                      max_depth = 8,
                      min_rows = 1,
                      learn_rate = 0.1,
                      sample_rate = 0.7,
                      col_sample_rate = 0.9,
                      nfolds = 5,
                      fold_assignment = &quot;Modulo&quot;,
                      keep_cross_validation_predictions = T,
                      seed = 1))</code></pre>
<pre><code>##     user   system  elapsed 
##    4.119    0.218 1197.915</code></pre>
</div>
<div id="extreme-gradient-boosted" class="section level2">
<h2><span class="header-section-number">10.5</span> eXtreme Gradient Boosted</h2>
<p>XGBoost constrói muitos modelos sequencialmente, com cada novo modelo tentando corrigir as deficiências do modelo anterior. Cada novo modelo adicionado ao conjunto é uma árvore de decisão. O XGBoost fornece boosting de árvore paralela.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<pre class="r"><code>system.time(model_xgb &lt;-
              h2o.xgboost(x = predictors,
                          y = response,
                          training_frame = h2o_treino,
                          distribution = &quot;gaussian&quot;,
                          ntrees = 50,
                          max_depth = 8,
                          backend = &quot;cpu&quot;,
                          min_rows = 1,
                          learn_rate = 0.1,
                          sample_rate = 0.7,
                          col_sample_rate = 0.9,
                          nfolds = 5,
                          fold_assignment = &quot;Modulo&quot;,
                          keep_cross_validation_predictions = T,
                          seed = 1))</code></pre>
<pre><code>##     user   system  elapsed 
##   13.375    0.669 3839.952</code></pre>
</div>
<div id="stacked-ensemble-super-learner" class="section level2">
<h2><span class="header-section-number">10.6</span> Stacked Ensemble (Super Learner)</h2>
<p>Algoritmo que agrupa modelos para encontrar a combinação ideal. Recebe como parâmetro uma lista com dois ou mais modelos.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<pre class="r"><code>system.time(model_stck &lt;-
              h2o.stackedEnsemble(x = predictors,
                                  y = response,
                                  training_frame = h2o_treino,
                                  metalearner_algorithm = &quot;AUTO&quot;,
                                  metalearner_nfolds = 5,
                                  base_models = list(model_rf@model_id,
                                                     model_xgb@model_id,
                                                     model_gbm@model_id,
                                                     model_glm@model_id),
                                  metalearner_fold_assignment = &quot;AUTO&quot;,
                                  seed = 1))</code></pre>
<pre><code>##    user  system elapsed 
##   0.144   0.004   8.188</code></pre>
</div>
</div>
<div id="avaliação-dos-modelos" class="section level1">
<h1><span class="header-section-number">11</span> Avaliação dos modelos</h1>
<div id="r2-r-ao-quadrado" class="section level2">
<h2><span class="header-section-number">11.1</span> R2 (R ao quadrado)</h2>
<p>O valor R2 representa o grau em que o valor previsto e o valor real se movem junto. O valor R2 varia entre 0 e 1, onde 0 representa nenhuma correlação entre o valor previsto e o valor real e 1 representa a correlação completa.</p>
</div>
<div id="mse-erro-quadrático-médio" class="section level2">
<h2><span class="header-section-number">11.2</span> MSE (erro quadrático médio)</h2>
<p>A métrica MSE mede a média dos quadrados dos erros ou desvios. MSE pega as distâncias dos pontos até a linha de regressão (essas distâncias são os “erros”) e as eleva ao quadrado para remover quaisquer sinais negativos. O MSE incorpora tanto a variância quanto o viés da previsão. Quanto menor o MSE, melhor será o desempenho do modelo.</p>
</div>
<div id="rmse-raiz-quadrada-do-erro-quadrático-médio" class="section level2">
<h2><span class="header-section-number">11.3</span> RMSE (raiz quadrada do erro quadrático médio)</h2>
<p>A métrica RMSE avalia quão bem um modelo pode prever um valor contínuo. As unidades RMSE são iguais ao alvo previsto, o que é útil para entender se o tamanho do erro é preocupante ou não. Quanto menor a RMSE, melhor será o desempenho do modelo.</p>
</div>
<div id="rmsle-raiz-quadrada-do-erro-logarítmico-médio-quadrático" class="section level2">
<h2><span class="header-section-number">11.4</span> RMSLE (raiz quadrada do erro logarítmico médio quadrático)</h2>
<p>Essa métrica mede a proporção entre os valores reais e os valores previstos e obtém o registro das previsões e dos valores reais. Métrica mais adequada do que RMSE se uma previsão insuficiente for pior que uma previsão excessiva. Métrica utilizada na avaliação da competição, portanto RMSLE é a mais importante para o caso em foco. Quanto menor a RMSLE, melhor será o desempenho do modelo.</p>
<p>Possivelmente o Grupo Bimbo considera pior deixar faltar seus produtos que tê-los devolvidos.</p>
</div>
<div id="mae-erro-médio-absoluto" class="section level2">
<h2><span class="header-section-number">11.5</span> MAE (erro médio absoluto)</h2>
<p>O erro absoluto médio, como próprio nome diz, é uma média dos erros absolutos. As unidades do MAE são iguais às da meta prevista, o que é útil para entender se o tamanho do erro é preocupante ou não. Quanto menor o MAE, melhor é o desempenho do modelo.</p>
</div>
<div id="tabela-de-performance" class="section level2">
<h2><span class="header-section-number">11.6</span> Tabela de performance</h2>
<pre class="r"><code># Objetos com os dados de performance de cada modelo
perf_rf &lt;- h2o.performance(model_rf)
perf_glm &lt;- h2o.performance(model_glm)
perf_gbm &lt;- h2o.performance(model_gbm)
perf_xgb &lt;- h2o.performance(model_xgb)
perf_stck &lt;- h2o.performance(model_stck)

# Extrai R2
R2 &lt;- c(h2o.r2(perf_rf),h2o.r2(perf_glm),h2o.r2(perf_gbm),
        h2o.r2(perf_xgb),h2o.r2(perf_stck))

# Extrai MSE
MSE &lt;- c(h2o.mse(perf_rf),h2o.mse(perf_glm),h2o.mse(perf_gbm),
         h2o.mse(perf_xgb),h2o.mse(perf_stck))

# Extrai RMSE
RMSE &lt;- c(h2o.rmse(perf_rf),h2o.rmse(perf_glm),h2o.rmse(perf_gbm),
          h2o.rmse(perf_xgb),h2o.rmse(perf_stck))

# Extrai RMSLE
RMSLE &lt;- c(h2o.rmsle(perf_rf),h2o.rmsle(perf_glm),h2o.rmsle(perf_gbm),
          h2o.rmsle(perf_xgb),h2o.rmsle(perf_stck))

# Extrai MAE
MAE &lt;- c(h2o.mae(perf_rf),h2o.mae(perf_glm),h2o.mae(perf_gbm),
         h2o.mae(perf_xgb),h2o.mae(perf_stck))

Modelo &lt;- c(&quot;Random Forest&quot;,&quot;Generalized Linear Model&quot;,&quot;Gradient Boosted&quot;,
            &quot;eXtreme Gradient Boosting&quot;,&quot;Stacked Ensemble&quot;)

# Tabela de performance
kable(data.frame(Modelo,R2,MSE,RMSE,RMSLE,MAE)) %&gt;% 
  kable_styling(full_width = F,
                bootstrap_options = c(&quot;striped&quot;,&quot;hover&quot;,&quot;condensed&quot;,&quot;responsive&quot;))</code></pre>
<table class="table table-striped table-hover table-condensed table-responsive" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
Modelo
</th>
<th style="text-align:right;">
R2
</th>
<th style="text-align:right;">
MSE
</th>
<th style="text-align:right;">
RMSE
</th>
<th style="text-align:right;">
RMSLE
</th>
<th style="text-align:right;">
MAE
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Random Forest
</td>
<td style="text-align:right;">
0.6963559
</td>
<td style="text-align:right;">
0.2138221
</td>
<td style="text-align:right;">
0.4624090
</td>
<td style="text-align:right;">
0.1975503
</td>
<td style="text-align:right;">
0.3475820
</td>
</tr>
<tr>
<td style="text-align:left;">
Generalized Linear Model
</td>
<td style="text-align:right;">
0.6228353
</td>
<td style="text-align:right;">
0.2655944
</td>
<td style="text-align:right;">
0.5153585
</td>
<td style="text-align:right;">
0.2137989
</td>
<td style="text-align:right;">
0.3902025
</td>
</tr>
<tr>
<td style="text-align:left;">
Gradient Boosted
</td>
<td style="text-align:right;">
0.7152862
</td>
<td style="text-align:right;">
0.2004916
</td>
<td style="text-align:right;">
0.4477629
</td>
<td style="text-align:right;">
0.1917299
</td>
<td style="text-align:right;">
0.3344079
</td>
</tr>
<tr>
<td style="text-align:left;">
eXtreme Gradient Boosting
</td>
<td style="text-align:right;">
0.7112733
</td>
<td style="text-align:right;">
0.2033175
</td>
<td style="text-align:right;">
0.4509074
</td>
<td style="text-align:right;">
0.1918409
</td>
<td style="text-align:right;">
0.3365273
</td>
</tr>
<tr>
<td style="text-align:left;">
Stacked Ensemble
</td>
<td style="text-align:right;">
0.7149667
</td>
<td style="text-align:right;">
0.2062378
</td>
<td style="text-align:right;">
0.4541342
</td>
<td style="text-align:right;">
0.1913701
</td>
<td style="text-align:right;">
0.3369070
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="previsão-e-submissão-ao-kaggle" class="section level1">
<h1><span class="header-section-number">12</span> Previsão e submissão ao Kaggle</h1>
<div id="previsão-e-geração-dos-arquivos" class="section level2">
<h2><span class="header-section-number">12.1</span> Previsão e geração dos arquivos</h2>
<p>A função inversa de <strong>log1p</strong> é <strong>expm1</strong> - exponencial de um número decrescido de uma unidade. Esta função será utilizada para transformar os valores previstos da variável alvo na mesma escala de <strong>Demanda_uni_equil</strong> nos dados de treino.</p>
<pre class="r"><code># Random Forest
system.time(predic_rf &lt;- h2o.predict(model_rf, h2o_teste))</code></pre>
<pre><code>##    user  system elapsed 
##   0.086   0.001  14.181</code></pre>
<pre class="r"><code>prev_rf &lt;- as.data.frame(predic_rf)
prev_rf &lt;- expm1(as.numeric(prev_rf$predict))
prev_rf[prev_rf &lt; 0] &lt;- 0
prev_rf &lt;- data.frame(id = id, Demanda_uni_equil = prev_rf)
fwrite(prev_rf,&quot;H2O_RandomForest.csv&quot;)

# GBM
system.time(predic_gbm &lt;- h2o.predict(model_gbm, h2o_teste))</code></pre>
<pre><code>##    user  system elapsed 
##   0.083   0.005  14.163</code></pre>
<pre class="r"><code>prev_gbm &lt;- as.data.frame(predic_gbm)
prev_gbm &lt;- expm1(as.numeric(prev_gbm$predict))
prev_gbm[prev_gbm &lt; 0] &lt;- 0
prev_gbm &lt;- data.frame(id = id, Demanda_uni_equil = prev_gbm)
fwrite(prev_gbm,&quot;H2O_GradientBoosted.csv&quot;)

# GLM
system.time(predic_glm &lt;- h2o.predict(model_glm, h2o_teste))</code></pre>
<pre><code>##    user  system elapsed 
##   0.038   0.000   1.061</code></pre>
<pre class="r"><code>prev_glm &lt;- as.data.frame(predic_glm)
prev_glm &lt;- expm1(as.numeric(prev_glm$predict))
prev_glm[prev_glm &lt; 0] &lt;- 0
prev_glm &lt;- data.frame(id = id, Demanda_uni_equil = prev_glm)
fwrite(prev_glm,&quot;H2O_GeneralizedLinearModel.csv&quot;)

# XGB
system.time(predic_xgb &lt;- h2o.predict(model_xgb, h2o_teste))</code></pre>
<pre><code>##    user  system elapsed 
##   0.064   0.001   6.123</code></pre>
<pre class="r"><code>prev_xgb &lt;- as.data.frame(predic_xgb)
prev_xgb &lt;- expm1(as.numeric(prev_xgb$predict))
prev_xgb[prev_xgb &lt; 0] &lt;- 0
prev_xgb &lt;- data.frame(id = id, Demanda_uni_equil = prev_xgb)
fwrite(prev_xgb,&quot;H2O_eXtremeGradientBoosting.csv&quot;)

# Stacked Ensemble
system.time(predic_stck &lt;- h2o.predict(model_stck, h2o_teste))</code></pre>
<pre><code>##    user  system elapsed 
##   0.116   0.007  33.179</code></pre>
<pre class="r"><code>prev_stck &lt;- as.data.frame(predic_stck)
prev_stck &lt;- expm1(as.numeric(prev_stck$predict))
prev_stck[prev_stck &lt; 0] &lt;- 0
prev_stck &lt;- data.frame(id = id, Demanda_uni_equil = prev_stck)
fwrite(prev_stck,&quot;H2O_StackedEnsemble.csv&quot;)

# Finaliza o cluster H2O
h2o.shutdown(prompt = F)</code></pre>
</div>
<div id="resultado-da-submissão-ao-kaggle" class="section level2">
<h2><span class="header-section-number">12.2</span> Resultado da submissão ao Kaggle</h2>
<p><img src="Kaggle.png" /></p>
</div>
</div>
<div id="conclusão" class="section level1">
<h1><span class="header-section-number">13</span> Conclusão</h1>
<p>Nesse trabalho vimos o dilema de negócio entre o desabastecimento e o prazo de validade, a associação da métrica de avaliação dos modelos com o problema de negócio a ser resolvido, join de datasets, extração de informação categórica “oculta” no texto (marcas dos produtos), inferência de vendas em lotes na análise da cauda de um histograma, visualizações do volume de vendas e devoluções sob diversos prismas com os treemaps, a necessidade de gerenciar a memória no ambiente quando trabalhamos com conjuntos de dados maiores e a transformação de variáveis de acordo com a métrica de avaliação do modelo.</p>
<p>Resolvemos um problema de regressão com cinco modelos distintos. Em um trabalho recente - <a href="https://carlosvblessa.github.io/TalkingData-AdTracking/">TalkingData AdTracking - Desafio de detecção de fraude</a> - resolvemos um problema de classificação binária, lá falamos mais sobre a H2O.ai e utilizamos métricas de avaliação diferentes das usadas aqui, adequadas para modelos de classificação.</p>
<p>Comparando RMSLE na avaliação local e no Kaggle constatamos praticamente a mesma ordem de classificação, apenas entre o Gradient Boosted e Stacked Ensemble houve a inversão entre o primeiro e o segundo melhor classificado. Essa verificação ressalta a importância da avaliação de modelos e a escolha da métrica adequada para cada caso pelo cientista de dados, pois no mundo “real” não teremos o Kaggle para avaliar nossos modelos.</p>
</div>
<div id="kaggle-notebooks" class="section level1">
<h1><span class="header-section-number">14</span> Kaggle Notebooks</h1>
<p>Para a construção desse trabalho usamos como inspiração e copiamos parte do código de alguns notebooks.</p>
<div id="análise-exploratória-1" class="section level2">
<h2><span class="header-section-number">14.1</span> Análise exploratória</h2>
<ul>
<li><a href="https://www.kaggle.com/apapiu/exploring-the-bimbo-data">Exploring the Bimbo Data</a></li>
<li><a href="https://www.kaggle.com/fabienvs/grupo-bimbo-data-analysis">Grupo Bimbo data analysis</a></li>
</ul>
</div>
<div id="engenharia-de-atributos-1" class="section level2">
<h2><span class="header-section-number">14.2</span> Engenharia de atributos</h2>
<ul>
<li><a href="https://www.kaggle.com/apapiu/poor-man-s-xgboost">Poor Man’s Xgboost</a></li>
<li><a href="https://www.kaggle.com/parthibangowthaman/log-mean-plus-lb-0-4700">Log_Mean_Plus LB: 0.4700</a></li>
</ul>
</div>
</div>
<div id="melhorando-o-resultado" class="section level1">
<h1><span class="header-section-number">15</span> Melhorando o resultado</h1>
<p>Após a conclusão desse trabalho apliquei o modelo de melhor desempenho (Gradient Boosted) a um conjunto maior de variáveis categóricas, 28 no total. Abaixo estão a imagem do resultado no Kaggle e o código da engenharia de atributos.</p>
<div id="resultado-da-submissão-ao-kaggle-1" class="section level2">
<h2><span class="header-section-number">15.1</span> Resultado da submissão ao Kaggle</h2>
<p><img src="Kaggle2.png" /></p>
</div>
<div id="engenharia-de-atributos-2" class="section level2">
<h2><span class="header-section-number">15.2</span> Engenharia de atributos</h2>
<p>Caso queira reproduzir o modelo é só utilizar o código abaixo e seguir essa publicação a partir do item 10.1 - Iniciar o cluster e preparar os datasets.</p>
<pre><code># Engenharia de atributos

library(data.table)
library(dplyr)
library(stringr)

system.time(treino &lt;- fread(&quot;train.csv&quot;,na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                            select = c(&quot;Semana&quot;, &quot;Agencia_ID&quot;, &quot;Canal_ID&quot;,
                                       &quot;Ruta_SAK&quot;, &quot;Cliente_ID&quot;, &quot;Producto_ID&quot;,
                                       &quot;Venta_uni_hoy&quot;,&quot;Venta_hoy&quot;,
                                       &quot;Dev_uni_proxima&quot;, &quot;Dev_proxima&quot;,
                                       &quot;Demanda_uni_equil&quot;),
                            colClasses = c(Semana = &quot;numeric&quot;,
                                           Agencia_ID = &quot;character&quot;,
                                           Canal_ID = &quot;character&quot;,
                                           Ruta_SAK = &quot;character&quot;,
                                           Cliente_ID = &quot;character&quot;,
                                           Producto_ID = &quot;character&quot;, 
                                           Venta_uni_hoy = &quot;numeric&quot;,
                                           Venta_hoy = &quot;numeric&quot;, 
                                           Dev_uni_proxima = &quot;numeric&quot;,
                                           Dev_proxima = &quot;numeric&quot;, 
                                           Demanda_uni_equil = &quot;numeric&quot;)))

system.time(teste &lt;- fread(&quot;test.csv&quot;, na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                           select = c(&quot;id&quot;, &quot;Semana&quot;, &quot;Agencia_ID&quot;, &quot;Canal_ID&quot;,
                                      &quot;Ruta_SAK&quot;, &quot;Cliente_ID&quot;,  &quot;Producto_ID&quot;),
                           colClasses = c(id = &quot;character&quot;,
                                          Semana = &quot;numeric&quot;,
                                          Agencia_ID = &quot;character&quot;,
                                          Canal_ID = &quot;character&quot;,
                                          Ruta_SAK = &quot;character&quot;,
                                          Cliente_ID = &quot;character&quot;,
                                          Producto_ID = &quot;character&quot;)))

produtos &lt;- fread(&quot;producto_tabla.csv&quot;, na.strings=c(&quot;&quot;,&quot;NA&quot;), nThread = 16,
                  encoding = &quot;UTF-8&quot;,select = c(&quot;Producto_ID&quot;,&quot;NombreProducto&quot;),
                  colClasses = c(Producto_ID = &quot;character&quot;,
                                 NombreProducto = &quot;character&quot;))

# Criar nova variável com as marcas constantes na variável NombreProducto

# Função para extrair o final da string, composta por marca (com duas ou três
# letras), um espaço em branco e números corespondentes ao código de produto.

substrFinal &lt;- function(x){
  substr(x, nchar(x)-nchar(str_extract(x,&quot;\\b\\d+$&quot;))-3, nchar(x))
}

# Cria a variável marca
produtos$Marca &lt;- str_extract(substrFinal(produtos$NombreProducto),&quot;[A-Z]+&quot;)

# Existe um produto denominado &quot;NO IDENTIFICADO&quot;, quando extraimos as últimas
# três letras, seguindo o padrão das demais, ficou como a marca &quot;ADO&quot;.
# Outros produtos com valores ausentes serão atribuídos a mesma marca fictícia
produtos$Marca[is.na(produtos$Marca)] &lt;- &quot;ADO&quot;


# Remoção de variáveis
treino[,c(&quot;Venta_uni_hoy&quot;,&quot;Venta_hoy&quot;,&quot;Dev_uni_proxima&quot;,&quot;Dev_proxima&quot;)] &lt;- NULL

# Trasforma variáveis de treino
treino[,c(2,3,4,5,6)] &lt;-  lapply(treino[,c(2,3,4,5,6)], as.integer)

# Trasforma variáveis de teste
teste[,c(1,3,4,5,6,7)] &lt;-  lapply(teste[,c(1,3,4,5,6,7)], as.integer)

# Trasforma Producto_ID em inteiros
produtos$Producto_ID &lt;- as.integer(produtos$Producto_ID)
# Transforma Marca em inteiros
produtos$Marca &lt;- as.integer(as.factor(produtos$Marca))

# Acrescenta a variável Marca no dataset de treino
treino &lt;- merge(x = treino, y = produtos[, c(&quot;Producto_ID&quot;,&quot;Marca&quot;)],
      by = &quot;Producto_ID&quot;, all.x = T)

# Acrescenta a variável Marca no dataset de teste
teste &lt;- merge(x = teste, y = produtos[, c(&quot;Producto_ID&quot;,&quot;Marca&quot;)],
                by = &quot;Producto_ID&quot;, all.x = T)

# Transformação da variável alvo com logaritmo do seu valor acrescido de uma
# unidade.
treino$Demanda_uni_equil &lt;- log1p(treino$Demanda_uni_equil)

# Cria variável id no dataset de treino, Demanda_uni_equil no dataset de test
# para que ambos tenham as mesmas variáveis. Também cria a variável tst para
# identificar se os dados são de treino ou de teste.
treino$id &lt;- 0; teste$Demanda_uni_equil &lt;- 0; treino$tst &lt;- 0; teste$tst &lt;- 1

# Agrega os dados de treino da nona semana com os dados de teste em um dataset
# que receberá os dados transformados
trans_treino &lt;- rbind(treino[Semana == 9], teste)

# Calcula a demanda média e a contagem das semanas de 3 a 8 e em seguida junta
# com as semanas 9, 10 e 11.

# Média e contagem por produto e cliente
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPC = mean(Demanda_uni_equil), CPC = .N),
                      by = .(Producto_ID, Cliente_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;, &quot;Cliente_ID&quot;))

# Média e contagem por produto
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MP = mean(Demanda_uni_equil), CP = .N),
                      by = .(Producto_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;))

# Média e contagem por cliente
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MC = mean(Demanda_uni_equil), CC = .N),
                      by = .(Cliente_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Cliente_ID&quot;))

# Média e contagem por produto e rota
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPR = mean(Demanda_uni_equil), CPR = .N),
                      by = .(Producto_ID, Ruta_SAK)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;, &quot;Ruta_SAK&quot;))

# Média e contagem por cliente e rota
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MCR = mean(Demanda_uni_equil), CCR = .N),
                      by = .(Cliente_ID, Ruta_SAK)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Cliente_ID&quot;, &quot;Ruta_SAK&quot;))

# Média e contagem por produto e agencia
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPA = mean(Demanda_uni_equil), CPA = .N),
                      by = .(Producto_ID, Agencia_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;, &quot;Agencia_ID&quot;))

# Média e contagem por produto, cliente  e agencia
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPCA = mean(Demanda_uni_equil), CPCA = .N),
                      by = .(Producto_ID, Cliente_ID, Agencia_ID)] %&gt;% 
  merge(trans_treino, all.y = TRUE, 
        by = c(&quot;Producto_ID&quot;, &quot;Cliente_ID&quot;, &quot;Agencia_ID&quot;))

# Média e contagem por produto e marca
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MPM = mean(Demanda_uni_equil), CPM = .N),
                      by = .(Producto_ID, Marca)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Producto_ID&quot;, &quot;Marca&quot;))

# Média e contagem por cliente e marca
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MCM = mean(Demanda_uni_equil), CCM = .N),
                      by = .(Cliente_ID, Marca)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Cliente_ID&quot;, &quot;Marca&quot;))

# Média e contagem por rota e marca
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MRM = mean(Demanda_uni_equil), CRM = .N),
                      by = .(Ruta_SAK, Marca)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Ruta_SAK&quot;, &quot;Marca&quot;))

# Média e contagem por agencia e marca
trans_treino &lt;- 
  treino[Semana &lt;= 8][, .(MAM = mean(Demanda_uni_equil), CAM = .N),
                      by = .(Agencia_ID, Marca)] %&gt;% 
  merge(trans_treino, all.y = TRUE, by = c(&quot;Agencia_ID&quot;, &quot;Marca&quot;))

str(trans_treino)

# Remove Semana
trans_treino$Semana &lt;- NULL

# Preenche valores ausentes com zero
trans_treino[is.na(trans_treino)] &lt;- 0

# Remoção de datasets
rm(treino,teste,produtos)

# Limpa a memória
gc()

# Reordena as variáveis
var_names &lt;- c(&quot;Agencia_ID&quot;,&quot;Canal_ID&quot;,&quot;Ruta_SAK&quot;,&quot;Cliente_ID&quot;,&quot;Producto_ID&quot;,
               &quot;Marca&quot;,&quot;CAM&quot;,&quot;CRM&quot;,&quot;CCM&quot;,&quot;CPM&quot;,&quot;CPCA&quot;,&quot;CPA&quot;,&quot;CCR&quot;,&quot;CC&quot;,&quot;CP&quot;,
               &quot;CPC&quot;,&quot;CPR&quot;,&quot;MAM&quot;,&quot;MRM&quot;,&quot;MCM&quot;,&quot;MPM&quot;,&quot;MPCA&quot;,&quot;MPA&quot;,&quot;MCR&quot;,&quot;MPR&quot;,
               &quot;MC&quot;,&quot;MP&quot;,&quot;MPC&quot;,&quot;Demanda_uni_equil&quot;,&quot;id&quot;,&quot;tst&quot;)

trans_treino &lt;- trans_treino[,..var_names]

# Aplica log1p
trans_treino[,1:17]  &lt;- lapply(trans_treino[,1:17], log1p)

# Salva o dataset

fwrite(trans_treino,&quot;trans_treino.csv&quot;)
</code></pre>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Distributed Random Forest (DRF)<br />
<a href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/drf.html" class="uri">https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/drf.html</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Generalized Linear Model (GLM) <a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/glm.html</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Gradient Boosting Machine (GBM) <a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/gbm.html" class="uri">http://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/gbm.html</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>XGBoost<br />
<a href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/xgboost.html" class="uri">https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/xgboost.html</a><a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>Stacked Ensembles<br />
<a href="https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/stacked-ensembles.html" class="uri">https://docs.h2o.ai/h2o/latest-stable/h2o-docs/data-science/stacked-ensembles.html</a><a href="#fnref5" class="footnote-back">↩︎</a></p></li>
</ol>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
